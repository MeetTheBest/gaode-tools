(function(c,d){typeof exports=="object"&&typeof module!="undefined"?d(exports):typeof define=="function"&&define.amd?define(["exports"],d):(c=typeof globalThis!="undefined"?globalThis:c||self,d(c["gaode-tools"]={}))})(this,function(c){"use strict";var Xs=Object.defineProperty,Zs=Object.defineProperties;var qs=Object.getOwnPropertyDescriptors;var Ge=Object.getOwnPropertySymbols;var Js=Object.prototype.hasOwnProperty,Qs=Object.prototype.propertyIsEnumerable;var Ct=(c,d,T)=>d in c?Xs(c,d,{enumerable:!0,configurable:!0,writable:!0,value:T}):c[d]=T,_=(c,d)=>{for(var T in d||(d={}))Js.call(d,T)&&Ct(c,T,d[T]);if(Ge)for(var T of Ge(d))Qs.call(d,T)&&Ct(c,T,d[T]);return c},$t=(c,d)=>Zs(c,qs(d));var a=(c,d,T)=>(Ct(c,typeof d!="symbol"?d+"":d,T),T);const d={"border-color":"#e1f5fe","font-size":"12px","border-radius":".25rem","background-color":"rgba(0,0,0,.4)","border-width":0,"text-align":"center",color:"#fff"},T=(t="",e={})=>new AMap.Text({text:t,style:_(_({},d),e),offset:[0,-10]}),z=(t,e)=>{const n=t.divideBy(2).add(e.divideBy(2));return{text:`${Math.round(t.distance(e))}米`,textPos:n}};let wt=class{constructor(e){a(this,"map");a(this,"startPointToCursorText",null);a(this,"lastPointToCursorText",null);a(this,"startPosition",null);a(this,"lastPosition",null);a(this,"getClickPosition",e=>{const n=e.lnglat;this.startPosition?this.startPosition&&(this.lastPosition=n,this.createDistanceText()):this.startPosition=n});a(this,"onMouseMoveInDrawPolygon",e=>{if(!this.startPosition||!this.lastPosition)return;const n=e.lnglat;this.updateDistanceText(this.startPointToCursorText,z(this.startPosition,n)),this.updateDistanceText(this.lastPointToCursorText,z(this.lastPosition,n))});if(!e)throw new Error("map not found!");this.map=e}start(){this.map.on("click",this.getClickPosition),this.map.on("mousemove",this.onMouseMoveInDrawPolygon)}stop(){this.map.off("click",this.getClickPosition),this.map.off("mousemove",this.onMouseMoveInDrawPolygon)}createDistanceText(){this.startPointToCursorText&&this.lastPointToCursorText||(this.startPointToCursorText=T(),this.startPointToCursorText.setMap(this.map),this.lastPointToCursorText=T(),this.lastPointToCursorText.setMap(this.map))}updateDistanceText(e,{text:n,textPos:o}){e.setText(n),e.setPosition(o)}removeDistanceText(){var e,n;(e=this.startPointToCursorText)==null||e.remove(),this.startPointToCursorText=null,(n=this.lastPointToCursorText)==null||n.remove(),this.lastPointToCursorText=null}reset(){return this.startPosition=null,this.lastPosition=null,this.removeDistanceText(),this}destroy(){return this.reset(),this.stop(),this}};var ze=typeof global=="object"&&global&&global.Object===Object&&global;const _t=ze;var He=typeof self=="object"&&self&&self.Object===Object&&self,We=_t||He||Function("return this")();const $=We;var Ke=$.Symbol;const k=Ke;var kt=Object.prototype,Ve=kt.hasOwnProperty,Ye=kt.toString,K=k?k.toStringTag:void 0;function Xe(t){var e=Ve.call(t,K),n=t[K];try{t[K]=void 0;var o=!0}catch(r){}var i=Ye.call(t);return o&&(e?t[K]=n:delete t[K]),i}var Ze=Object.prototype,qe=Ze.toString;function Je(t){return qe.call(t)}var Qe="[object Null]",tn="[object Undefined]",Lt=k?k.toStringTag:void 0;function S(t){return t==null?t===void 0?tn:Qe:Lt&&Lt in Object(t)?Xe(t):Je(t)}function I(t){return t!=null&&typeof t=="object"}var en="[object Symbol]";function J(t){return typeof t=="symbol"||I(t)&&S(t)==en}function Ot(t,e){for(var n=-1,o=t==null?0:t.length,i=Array(o);++n<o;)i[n]=e(t[n],n,t);return i}var nn=Array.isArray;const D=nn;var on=1/0,At=k?k.prototype:void 0,jt=At?At.toString:void 0;function St(t){if(typeof t=="string")return t;if(D(t))return Ot(t,St)+"";if(J(t))return jt?jt.call(t):"";var e=t+"";return e=="0"&&1/t==-on?"-0":e}var rn=/\s/;function sn(t){for(var e=t.length;e--&&rn.test(t.charAt(e)););return e}var an=/^\s+/;function ln(t){return t&&t.slice(0,sn(t)+1).replace(an,"")}function L(t){var e=typeof t;return t!=null&&(e=="object"||e=="function")}var It=0/0,hn=/^[-+]0x[0-9a-f]+$/i,cn=/^0b[01]+$/i,un=/^0o[0-7]+$/i,gn=parseInt;function ot(t){if(typeof t=="number")return t;if(J(t))return It;if(L(t)){var e=typeof t.valueOf=="function"?t.valueOf():t;t=L(e)?e+"":e}if(typeof t!="string")return t===0?t:+t;t=ln(t);var n=cn.test(t);return n||un.test(t)?gn(t.slice(2),n?2:8):hn.test(t)?It:+t}function Dt(t){return t}var fn="[object AsyncFunction]",pn="[object Function]",dn="[object GeneratorFunction]",yn="[object Proxy]";function Rt(t){if(!L(t))return!1;var e=S(t);return e==pn||e==dn||e==fn||e==yn}var Tn=$["__core-js_shared__"];const it=Tn;var Bt=function(){var t=/[^.]+$/.exec(it&&it.keys&&it.keys.IE_PROTO||"");return t?"Symbol(src)_1."+t:""}();function Pn(t){return!!Bt&&Bt in t}var mn=Function.prototype,bn=mn.toString;function R(t){if(t!=null){try{return bn.call(t)}catch(e){}try{return t+""}catch(e){}}return""}var vn=/[\\^$.*+?()[\]{}|]/g,Mn=/^\[object .+?Constructor\]$/,xn=Function.prototype,En=Object.prototype,Cn=xn.toString,$n=En.hasOwnProperty,wn=RegExp("^"+Cn.call($n).replace(vn,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");function _n(t){if(!L(t)||Pn(t))return!1;var e=Rt(t)?wn:Mn;return e.test(R(t))}function kn(t,e){return t==null?void 0:t[e]}function B(t,e){var n=kn(t,e);return _n(n)?n:void 0}var Ln=B($,"WeakMap");const rt=Ln;var Ft=Object.create,On=function(){function t(){}return function(e){if(!L(e))return{};if(Ft)return Ft(e);t.prototype=e;var n=new t;return t.prototype=void 0,n}}();const An=On;function jn(t,e,n){switch(n.length){case 0:return t.call(e);case 1:return t.call(e,n[0]);case 2:return t.call(e,n[0],n[1]);case 3:return t.call(e,n[0],n[1],n[2])}return t.apply(e,n)}function Sn(t,e){var n=-1,o=t.length;for(e||(e=Array(o));++n<o;)e[n]=t[n];return e}var In=800,Dn=16,Rn=Date.now;function Bn(t){var e=0,n=0;return function(){var o=Rn(),i=Dn-(o-n);if(n=o,i>0){if(++e>=In)return arguments[0]}else e=0;return t.apply(void 0,arguments)}}function Fn(t){return function(){return t}}var Nn=function(){try{var t=B(Object,"defineProperty");return t({},"",{}),t}catch(e){}}();const Q=Nn;var Un=Q?function(t,e){return Q(t,"toString",{configurable:!0,enumerable:!1,value:Fn(e),writable:!0})}:Dt,Gn=Bn(Un);const Nt=Gn;function zn(t,e){for(var n=-1,o=t==null?0:t.length;++n<o&&e(t[n],n,t)!==!1;);return t}var Hn=9007199254740991,Wn=/^(?:0|[1-9]\d*)$/;function Kn(t,e){var n=typeof t;return e=e==null?Hn:e,!!e&&(n=="number"||n!="symbol"&&Wn.test(t))&&t>-1&&t%1==0&&t<e}function Ut(t,e,n){e=="__proto__"&&Q?Q(t,e,{configurable:!0,enumerable:!0,value:n,writable:!0}):t[e]=n}function Gt(t,e){return t===e||t!==t&&e!==e}var Vn=Object.prototype,Yn=Vn.hasOwnProperty;function zt(t,e,n){var o=t[e];(!(Yn.call(t,e)&&Gt(o,n))||n===void 0&&!(e in t))&&Ut(t,e,n)}function V(t,e,n,o){var i=!n;n||(n={});for(var r=-1,s=e.length;++r<s;){var l=e[r],h=o?o(n[l],t[l],l,n,t):void 0;h===void 0&&(h=t[l]),i?Ut(n,l,h):zt(n,l,h)}return n}var Ht=Math.max;function Wt(t,e,n){return e=Ht(e===void 0?t.length-1:e,0),function(){for(var o=arguments,i=-1,r=Ht(o.length-e,0),s=Array(r);++i<r;)s[i]=o[e+i];i=-1;for(var l=Array(e+1);++i<e;)l[i]=o[i];return l[e]=n(s),jn(t,this,l)}}function Xn(t,e){return Nt(Wt(t,e,Dt),t+"")}var Zn=9007199254740991;function Kt(t){return typeof t=="number"&&t>-1&&t%1==0&&t<=Zn}function Vt(t){return t!=null&&Kt(t.length)&&!Rt(t)}var qn=Object.prototype;function st(t){var e=t&&t.constructor,n=typeof e=="function"&&e.prototype||qn;return t===n}function Jn(t,e){for(var n=-1,o=Array(t);++n<t;)o[n]=e(n);return o}var Qn="[object Arguments]";function Yt(t){return I(t)&&S(t)==Qn}var Xt=Object.prototype,to=Xt.hasOwnProperty,eo=Xt.propertyIsEnumerable,no=Yt(function(){return arguments}())?Yt:function(t){return I(t)&&to.call(t,"callee")&&!eo.call(t,"callee")};const Zt=no;function oo(){return!1}var qt=typeof c=="object"&&c&&!c.nodeType&&c,Jt=qt&&typeof module=="object"&&module&&!module.nodeType&&module,io=Jt&&Jt.exports===qt,Qt=io?$.Buffer:void 0,ro=Qt?Qt.isBuffer:void 0,so=ro||oo;const te=so;var ao="[object Arguments]",lo="[object Array]",ho="[object Boolean]",co="[object Date]",uo="[object Error]",go="[object Function]",fo="[object Map]",po="[object Number]",yo="[object Object]",To="[object RegExp]",Po="[object Set]",mo="[object String]",bo="[object WeakMap]",vo="[object ArrayBuffer]",Mo="[object DataView]",xo="[object Float32Array]",Eo="[object Float64Array]",Co="[object Int8Array]",$o="[object Int16Array]",wo="[object Int32Array]",_o="[object Uint8Array]",ko="[object Uint8ClampedArray]",Lo="[object Uint16Array]",Oo="[object Uint32Array]",f={};f[xo]=f[Eo]=f[Co]=f[$o]=f[wo]=f[_o]=f[ko]=f[Lo]=f[Oo]=!0,f[ao]=f[lo]=f[vo]=f[ho]=f[Mo]=f[co]=f[uo]=f[go]=f[fo]=f[po]=f[yo]=f[To]=f[Po]=f[mo]=f[bo]=!1;function Ao(t){return I(t)&&Kt(t.length)&&!!f[S(t)]}function at(t){return function(e){return t(e)}}var ee=typeof c=="object"&&c&&!c.nodeType&&c,Y=ee&&typeof module=="object"&&module&&!module.nodeType&&module,jo=Y&&Y.exports===ee,lt=jo&&_t.process,So=function(){try{var t=Y&&Y.require&&Y.require("util").types;return t||lt&&lt.binding&&lt.binding("util")}catch(e){}}();const H=So;var ne=H&&H.isTypedArray,Io=ne?at(ne):Ao;const Do=Io;var Ro=Object.prototype,Bo=Ro.hasOwnProperty;function oe(t,e){var n=D(t),o=!n&&Zt(t),i=!n&&!o&&te(t),r=!n&&!o&&!i&&Do(t),s=n||o||i||r,l=s?Jn(t.length,String):[],h=l.length;for(var u in t)(e||Bo.call(t,u))&&!(s&&(u=="length"||i&&(u=="offset"||u=="parent")||r&&(u=="buffer"||u=="byteLength"||u=="byteOffset")||Kn(u,h)))&&l.push(u);return l}function ie(t,e){return function(n){return t(e(n))}}var Fo=ie(Object.keys,Object);const No=Fo;var Uo=Object.prototype,Go=Uo.hasOwnProperty;function zo(t){if(!st(t))return No(t);var e=[];for(var n in Object(t))Go.call(t,n)&&n!="constructor"&&e.push(n);return e}function ht(t){return Vt(t)?oe(t):zo(t)}function Ho(t){var e=[];if(t!=null)for(var n in Object(t))e.push(n);return e}var Wo=Object.prototype,Ko=Wo.hasOwnProperty;function Vo(t){if(!L(t))return Ho(t);var e=st(t),n=[];for(var o in t)o=="constructor"&&(e||!Ko.call(t,o))||n.push(o);return n}function ct(t){return Vt(t)?oe(t,!0):Vo(t)}var Yo=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,Xo=/^\w*$/;function Zo(t,e){if(D(t))return!1;var n=typeof t;return n=="number"||n=="symbol"||n=="boolean"||t==null||J(t)?!0:Xo.test(t)||!Yo.test(t)||e!=null&&t in Object(e)}var qo=B(Object,"create");const X=qo;function Jo(){this.__data__=X?X(null):{},this.size=0}function Qo(t){var e=this.has(t)&&delete this.__data__[t];return this.size-=e?1:0,e}var ti="__lodash_hash_undefined__",ei=Object.prototype,ni=ei.hasOwnProperty;function oi(t){var e=this.__data__;if(X){var n=e[t];return n===ti?void 0:n}return ni.call(e,t)?e[t]:void 0}var ii=Object.prototype,ri=ii.hasOwnProperty;function si(t){var e=this.__data__;return X?e[t]!==void 0:ri.call(e,t)}var ai="__lodash_hash_undefined__";function li(t,e){var n=this.__data__;return this.size+=this.has(t)?0:1,n[t]=X&&e===void 0?ai:e,this}function F(t){var e=-1,n=t==null?0:t.length;for(this.clear();++e<n;){var o=t[e];this.set(o[0],o[1])}}F.prototype.clear=Jo,F.prototype.delete=Qo,F.prototype.get=oi,F.prototype.has=si,F.prototype.set=li;function hi(){this.__data__=[],this.size=0}function tt(t,e){for(var n=t.length;n--;)if(Gt(t[n][0],e))return n;return-1}var ci=Array.prototype,ui=ci.splice;function gi(t){var e=this.__data__,n=tt(e,t);if(n<0)return!1;var o=e.length-1;return n==o?e.pop():ui.call(e,n,1),--this.size,!0}function fi(t){var e=this.__data__,n=tt(e,t);return n<0?void 0:e[n][1]}function pi(t){return tt(this.__data__,t)>-1}function di(t,e){var n=this.__data__,o=tt(n,t);return o<0?(++this.size,n.push([t,e])):n[o][1]=e,this}function O(t){var e=-1,n=t==null?0:t.length;for(this.clear();++e<n;){var o=t[e];this.set(o[0],o[1])}}O.prototype.clear=hi,O.prototype.delete=gi,O.prototype.get=fi,O.prototype.has=pi,O.prototype.set=di;var yi=B($,"Map");const Z=yi;function Ti(){this.size=0,this.__data__={hash:new F,map:new(Z||O),string:new F}}function Pi(t){var e=typeof t;return e=="string"||e=="number"||e=="symbol"||e=="boolean"?t!=="__proto__":t===null}function et(t,e){var n=t.__data__;return Pi(e)?n[typeof e=="string"?"string":"hash"]:n.map}function mi(t){var e=et(this,t).delete(t);return this.size-=e?1:0,e}function bi(t){return et(this,t).get(t)}function vi(t){return et(this,t).has(t)}function Mi(t,e){var n=et(this,t),o=n.size;return n.set(t,e),this.size+=n.size==o?0:1,this}function A(t){var e=-1,n=t==null?0:t.length;for(this.clear();++e<n;){var o=t[e];this.set(o[0],o[1])}}A.prototype.clear=Ti,A.prototype.delete=mi,A.prototype.get=bi,A.prototype.has=vi,A.prototype.set=Mi;var xi="Expected a function";function ut(t,e){if(typeof t!="function"||e!=null&&typeof e!="function")throw new TypeError(xi);var n=function(){var o=arguments,i=e?e.apply(this,o):o[0],r=n.cache;if(r.has(i))return r.get(i);var s=t.apply(this,o);return n.cache=r.set(i,s)||r,s};return n.cache=new(ut.Cache||A),n}ut.Cache=A;var Ei=500;function Ci(t){var e=ut(t,function(o){return n.size===Ei&&n.clear(),o}),n=e.cache;return e}var $i=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,wi=/\\(\\)?/g,_i=Ci(function(t){var e=[];return t.charCodeAt(0)===46&&e.push(""),t.replace($i,function(n,o,i,r){e.push(i?r.replace(wi,"$1"):o||n)}),e});const ki=_i;function Li(t){return t==null?"":St(t)}function gt(t,e){return D(t)?t:Zo(t,e)?[t]:ki(Li(t))}var Oi=1/0;function re(t){if(typeof t=="string"||J(t))return t;var e=t+"";return e=="0"&&1/t==-Oi?"-0":e}function se(t,e){e=gt(e,t);for(var n=0,o=e.length;t!=null&&n<o;)t=t[re(e[n++])];return n&&n==o?t:void 0}function ae(t,e,n){var o=t==null?void 0:se(t,e);return o===void 0?n:o}function ft(t,e){for(var n=-1,o=e.length,i=t.length;++n<o;)t[i+n]=e[n];return t}var le=k?k.isConcatSpreadable:void 0;function Ai(t){return D(t)||Zt(t)||!!(le&&t&&t[le])}function he(t,e,n,o,i){var r=-1,s=t.length;for(n||(n=Ai),i||(i=[]);++r<s;){var l=t[r];e>0&&n(l)?e>1?he(l,e-1,n,o,i):ft(i,l):o||(i[i.length]=l)}return i}function ji(t){var e=t==null?0:t.length;return e?he(t,1):[]}function Si(t){return Nt(Wt(t,void 0,ji),t+"")}var Ii=ie(Object.getPrototypeOf,Object);const pt=Ii;var Di="[object Object]",Ri=Function.prototype,Bi=Object.prototype,ce=Ri.toString,Fi=Bi.hasOwnProperty,Ni=ce.call(Object);function Ui(t){if(!I(t)||S(t)!=Di)return!1;var e=pt(t);if(e===null)return!0;var n=Fi.call(e,"constructor")&&e.constructor;return typeof n=="function"&&n instanceof n&&ce.call(n)==Ni}function Gi(t,e,n){var o=-1,i=t.length;e<0&&(e=-e>i?0:i+e),n=n>i?i:n,n<0&&(n+=i),i=e>n?0:n-e>>>0,e>>>=0;for(var r=Array(i);++o<i;)r[o]=t[o+e];return r}function zi(){this.__data__=new O,this.size=0}function Hi(t){var e=this.__data__,n=e.delete(t);return this.size=e.size,n}function Wi(t){return this.__data__.get(t)}function Ki(t){return this.__data__.has(t)}var Vi=200;function Yi(t,e){var n=this.__data__;if(n instanceof O){var o=n.__data__;if(!Z||o.length<Vi-1)return o.push([t,e]),this.size=++n.size,this;n=this.__data__=new A(o)}return n.set(t,e),this.size=n.size,this}function W(t){var e=this.__data__=new O(t);this.size=e.size}W.prototype.clear=zi,W.prototype.delete=Hi,W.prototype.get=Wi,W.prototype.has=Ki,W.prototype.set=Yi;function Xi(t,e){return t&&V(e,ht(e),t)}function Zi(t,e){return t&&V(e,ct(e),t)}var ue=typeof c=="object"&&c&&!c.nodeType&&c,ge=ue&&typeof module=="object"&&module&&!module.nodeType&&module,qi=ge&&ge.exports===ue,fe=qi?$.Buffer:void 0,pe=fe?fe.allocUnsafe:void 0;function Ji(t,e){if(e)return t.slice();var n=t.length,o=pe?pe(n):new t.constructor(n);return t.copy(o),o}function Qi(t,e){for(var n=-1,o=t==null?0:t.length,i=0,r=[];++n<o;){var s=t[n];e(s,n,t)&&(r[i++]=s)}return r}function de(){return[]}var tr=Object.prototype,er=tr.propertyIsEnumerable,ye=Object.getOwnPropertySymbols,nr=ye?function(t){return t==null?[]:(t=Object(t),Qi(ye(t),function(e){return er.call(t,e)}))}:de;const dt=nr;function or(t,e){return V(t,dt(t),e)}var ir=Object.getOwnPropertySymbols,rr=ir?function(t){for(var e=[];t;)ft(e,dt(t)),t=pt(t);return e}:de;const Te=rr;function sr(t,e){return V(t,Te(t),e)}function Pe(t,e,n){var o=e(t);return D(t)?o:ft(o,n(t))}function ar(t){return Pe(t,ht,dt)}function me(t){return Pe(t,ct,Te)}var lr=B($,"DataView");const yt=lr;var hr=B($,"Promise");const Tt=hr;var cr=B($,"Set");const Pt=cr;var be="[object Map]",ur="[object Object]",ve="[object Promise]",Me="[object Set]",xe="[object WeakMap]",Ee="[object DataView]",gr=R(yt),fr=R(Z),pr=R(Tt),dr=R(Pt),yr=R(rt),N=S;(yt&&N(new yt(new ArrayBuffer(1)))!=Ee||Z&&N(new Z)!=be||Tt&&N(Tt.resolve())!=ve||Pt&&N(new Pt)!=Me||rt&&N(new rt)!=xe)&&(N=function(t){var e=S(t),n=e==ur?t.constructor:void 0,o=n?R(n):"";if(o)switch(o){case gr:return Ee;case fr:return be;case pr:return ve;case dr:return Me;case yr:return xe}return e});const mt=N;var Tr=Object.prototype,Pr=Tr.hasOwnProperty;function mr(t){var e=t.length,n=new t.constructor(e);return e&&typeof t[0]=="string"&&Pr.call(t,"index")&&(n.index=t.index,n.input=t.input),n}var br=$.Uint8Array;const Ce=br;function bt(t){var e=new t.constructor(t.byteLength);return new Ce(e).set(new Ce(t)),e}function vr(t,e){var n=e?bt(t.buffer):t.buffer;return new t.constructor(n,t.byteOffset,t.byteLength)}var Mr=/\w*$/;function xr(t){var e=new t.constructor(t.source,Mr.exec(t));return e.lastIndex=t.lastIndex,e}var $e=k?k.prototype:void 0,we=$e?$e.valueOf:void 0;function Er(t){return we?Object(we.call(t)):{}}function Cr(t,e){var n=e?bt(t.buffer):t.buffer;return new t.constructor(n,t.byteOffset,t.length)}var $r="[object Boolean]",wr="[object Date]",_r="[object Map]",kr="[object Number]",Lr="[object RegExp]",Or="[object Set]",Ar="[object String]",jr="[object Symbol]",Sr="[object ArrayBuffer]",Ir="[object DataView]",Dr="[object Float32Array]",Rr="[object Float64Array]",Br="[object Int8Array]",Fr="[object Int16Array]",Nr="[object Int32Array]",Ur="[object Uint8Array]",Gr="[object Uint8ClampedArray]",zr="[object Uint16Array]",Hr="[object Uint32Array]";function Wr(t,e,n){var o=t.constructor;switch(e){case Sr:return bt(t);case $r:case wr:return new o(+t);case Ir:return vr(t,n);case Dr:case Rr:case Br:case Fr:case Nr:case Ur:case Gr:case zr:case Hr:return Cr(t,n);case _r:return new o;case kr:case Ar:return new o(t);case Lr:return xr(t);case Or:return new o;case jr:return Er(t)}}function Kr(t){return typeof t.constructor=="function"&&!st(t)?An(pt(t)):{}}var Vr="[object Map]";function Yr(t){return I(t)&&mt(t)==Vr}var _e=H&&H.isMap,Xr=_e?at(_e):Yr;const Zr=Xr;var qr="[object Set]";function Jr(t){return I(t)&&mt(t)==qr}var ke=H&&H.isSet,Qr=ke?at(ke):Jr;const ts=Qr;var es=1,ns=2,os=4,Le="[object Arguments]",is="[object Array]",rs="[object Boolean]",ss="[object Date]",as="[object Error]",Oe="[object Function]",ls="[object GeneratorFunction]",hs="[object Map]",cs="[object Number]",Ae="[object Object]",us="[object RegExp]",gs="[object Set]",fs="[object String]",ps="[object Symbol]",ds="[object WeakMap]",ys="[object ArrayBuffer]",Ts="[object DataView]",Ps="[object Float32Array]",ms="[object Float64Array]",bs="[object Int8Array]",vs="[object Int16Array]",Ms="[object Int32Array]",xs="[object Uint8Array]",Es="[object Uint8ClampedArray]",Cs="[object Uint16Array]",$s="[object Uint32Array]",g={};g[Le]=g[is]=g[ys]=g[Ts]=g[rs]=g[ss]=g[Ps]=g[ms]=g[bs]=g[vs]=g[Ms]=g[hs]=g[cs]=g[Ae]=g[us]=g[gs]=g[fs]=g[ps]=g[xs]=g[Es]=g[Cs]=g[$s]=!0,g[as]=g[Oe]=g[ds]=!1;function nt(t,e,n,o,i,r){var s,l=e&es,h=e&ns,u=e&os;if(n&&(s=i?n(t,o,i,r):n(t)),s!==void 0)return s;if(!L(t))return t;var y=D(t);if(y){if(s=mr(t),!l)return Sn(t,s)}else{var b=mt(t),P=b==Oe||b==ls;if(te(t))return Ji(t,l);if(b==Ae||b==Le||P&&!i){if(s=h||P?{}:Kr(t),!l)return h?sr(t,Zi(s,t)):or(t,Xi(s,t))}else{if(!g[b])return i?t:{};s=Wr(t,b,l)}}r||(r=new W);var p=r.get(t);if(p)return p;r.set(t,s),ts(t)?t.forEach(function(v){s.add(nt(v,e,n,v,t,r))}):Zr(t)&&t.forEach(function(v,M){s.set(M,nt(v,e,n,M,t,r))});var w=u?h?me:ar:h?ct:ht,C=y?void 0:w(t);return zn(C||t,function(v,M){C&&(M=v,v=t[M]),zt(s,M,nt(v,e,n,M,t,r))}),s}var ws=function(){return $.Date.now()};const vt=ws;var _s="Expected a function",ks=Math.max,Ls=Math.min;function Os(t,e,n){var o,i,r,s,l,h,u=0,y=!1,b=!1,P=!0;if(typeof t!="function")throw new TypeError(_s);e=ot(e)||0,L(n)&&(y=!!n.leading,b="maxWait"in n,r=b?ks(ot(n.maxWait)||0,e):r,P="trailing"in n?!!n.trailing:P);function p(m){var j=o,q=i;return o=i=void 0,u=m,s=t.apply(q,j),s}function w(m){return u=m,l=setTimeout(M,e),y?p(m):s}function C(m){var j=m-h,q=m-u,Ue=e-j;return b?Ls(Ue,r-q):Ue}function v(m){var j=m-h,q=m-u;return h===void 0||j>=e||j<0||b&&q>=r}function M(){var m=vt();if(v(m))return x(m);l=setTimeout(M,C(m))}function x(m){return l=void 0,P&&o?p(m):(o=i=void 0,s)}function U(){l!==void 0&&clearTimeout(l),u=0,o=h=i=l=void 0}function E(){return l===void 0?s:x(vt())}function G(){var m=vt(),j=v(m);if(o=arguments,i=this,h=m,j){if(l===void 0)return w(h);if(b)return clearTimeout(l),l=setTimeout(M,e),p(h)}return l===void 0&&(l=setTimeout(M,e)),s}return G.cancel=U,G.flush=E,G}var As="Expected a function";function js(t,e,n){if(typeof t!="function")throw new TypeError(As);return setTimeout(function(){t.apply(void 0,n)},e)}var Ss=Xn(function(t,e,n){return js(t,ot(e)||0,n)});const Mt=Ss;function Is(t){var e=t==null?0:t.length;return e?t[e-1]:void 0}function Ds(t,e){return e.length<2?t:se(t,Gi(e,0,-1))}function Rs(t,e){return e=gt(e,t),t=Ds(t,e),t==null||delete t[re(Is(e))]}function Bs(t){return Ui(t)?void 0:t}var Fs=1,Ns=2,Us=4,Gs=Si(function(t,e){var n={};if(t==null)return n;var o=!1;e=Ot(e,function(r){return r=gt(r,t),o||(o=r.length>1),r}),V(t,me(t),n),o&&(n=nt(n,Fs|Ns|Us,Bs));for(var i=e.length;i--;)Rs(n,e[i]);return n});const zs=Gs;var Hs="Expected a function";function Ws(t,e,n){var o=!0,i=!0;if(typeof t!="function")throw new TypeError(Hs);return L(n)&&(o="leading"in n?!!n.leading:o,i="trailing"in n?!!n.trailing:i),Os(t,e,{leading:o,maxWait:e,trailing:i})}const je={radius:6,zIndex:0,strokeOpacity:0,fillOpacity:0};class xt{constructor(e){a(this,"map");a(this,"options",_({},je));a(this,"circleMarkers",[]);this.map=e}setOptions(e){return this.options=_(_({},e),zs(je,"radius")),this}createCircleMarkersByPaths(e){this.removeFromTheMap(),this.reset(),e.forEach(n=>{this.circleMarkers.push(this.createCircleMarker(n))}),this.addToMap()}createCircleMarker(e){return new AMap.CircleMarker(_({center:e},this.options))}addToMap(){this.map.add(this.circleMarkers)}removeFromTheMap(){this.map.remove(this.circleMarkers)}getPointInCircleMarkers(e){var n;return(n=this.circleMarkers.find(o=>this.isPointInCircle(e,o)))!=null?n:null}getInCircleMarkersPoint(e){const n=this.circleMarkers.find(i=>this.isPointInCircle(e,i));return this.circleMarkers.findIndex(i=>i===n)%2===0?null:n!=null?n:null}isPointInCircle(e,n){return n.contains(e)}reset(){this.circleMarkers=[]}destroy(){this.removeFromTheMap(),this.reset()}}const Se={zIndex:1,strokeColor:"#00D3FC",strokeWeight:8,strokeOpacity:0};class Ie{constructor(e){a(this,"map");a(this,"linesPath",[]);a(this,"lines",[]);if(!e)throw new Error("map not found");this.map=e}getLinesByPaths(e){let n=0;const o=e.length;for(;n<o;){const i=n+1>=o?0:n+1;this.linesPath.push([e[n],e[i]]),n++}return this.linesPath}createLinesByPaths(e){this.reset(),this.getLinesByPaths(e)}createPolyLine(e){return new AMap.Polyline(_({path:e},Se))}addToMap(){this.map.add(this.lines)}removeFromTheMap(){this.map.remove(this.lines)}getPointInPolyline(e){const n=this.map.getResolution(),o=Se.strokeWeight*n;return this.linesPath.find(r=>AMap.GeometryUtil.isPointOnSegment(e,r[0],r[1],o))}reset(){this.linesPath=[],this.lines=[]}}class De{constructor(e,n){a(this,"map");a(this,"circleMarkers",null);a(this,"midCircleMarkers",null);a(this,"lines",null);a(this,"polygonEditor",null);a(this,"polygonPaths",[]);a(this,"polygonTotalPaths",[]);a(this,"polygon",null);a(this,"startPointToCursorText",null);a(this,"lastPointToCursorText",null);a(this,"lineLengthText",null);a(this,"circleMarker",null);a(this,"midCircleMarker",null);a(this,"startPosition",null);a(this,"lastPosition",null);a(this,"editingMidTipMarkerListPath",null);a(this,"onPolygonEditorAdjust",({target:e})=>{this.polygonPaths=e.getPath(),this.circleMarkers.createCircleMarkersByPaths(this.polygonPaths),this.lines.createLinesByPaths(this.polygonPaths),Promise.resolve().then(()=>{this.polygonTotalPaths=this.getPolygonEditorTargetTotalPaths(),this.midCircleMarkers.createCircleMarkersByPaths(this.polygonTotalPaths)}),this.reset()});a(this,"onMouseDown",e=>{const n=e.lnglat;this.circleMarker=this.circleMarkers.getPointInCircleMarkers(n),this.midCircleMarker=this.midCircleMarkers.getInCircleMarkersPoint(n)});a(this,"onMovePolygonEditorPoint",e=>{if(this.midCircleMarker)return;if(!this.circleMarker){this.reset();return}const n=this.circleMarker.getCenter(),o=y=>`${y.lng}-${y.lat}`;let i=this.polygonPaths.findIndex(y=>o(y)===o(n));if(i===-1)return;const r=this.polygonPaths.length,s=i-1<=-1?r-1:i-1,l=i+1>=r?0:i+1,h=this.polygonPaths.at(s),u=this.polygonPaths.at(l);this.setPosition(h,u),this.onMouseMoveInDrawPolygon(e)});a(this,"onMovePolygonEditorMidPoint",e=>{if(this.circleMarker)return;if(!this.midCircleMarker){this.reset();return}const n=this.midCircleMarker.getCenter(),o=y=>`${y.lng}-${y.lat}`;let i=this.polygonTotalPaths.findIndex(y=>o(y)===o(n));if(i===-1)return;const r=this.polygonTotalPaths.length,s=i-1<=-1?r-1:i-1,l=i+1>=r?0:i+1,h=this.polygonTotalPaths.at(s),u=this.polygonTotalPaths.at(l);this.setPosition(h,u),this.onMouseMoveInDrawPolygon(e)});a(this,"onMouseUp",()=>{this.circleMarker=null,this.midCircleMarker=null,this.reset()});a(this,"onInPolygonEditorLine",e=>{if(this.circleMarker)return this.removeLineDistanceText();const n=e.lnglat,o=this.lines.getPointInPolyline(n);if(!o)return this.removeLineDistanceText();const[i,r]=o;this.lineLengthText||(this.lineLengthText=T(),this.lineLengthText.add(this.map)),this.updateDistanceText(this.lineLengthText,z(i,r))});a(this,"onMouseMoveInDrawPolygon",e=>{if(!this.startPosition||!this.lastPosition)return;const n=e.lnglat;this.updateDistanceText(this.startPointToCursorText,z(this.startPosition,n)),this.updateDistanceText(this.lastPointToCursorText,z(this.lastPosition,n))});if(!e)throw new Error("map not found!");this.map=e,n&&(this.polygonEditor=n),this.circleMarkers=new xt(this.map),this.midCircleMarkers=new xt(this.map),this.lines=new Ie(this.map)}getPolygonEditorTargetPaths(){var e;return this.polygonEditor?(e=this.polygonEditor.getTarget().getPath())!=null?e:[]:[]}setEditingMidTipMarkerListPath(e){return this.editingMidTipMarkerListPath=e,this}getEditingMidTipMarkerList(){var n,o;const{singleRingListHandle:e}=this.polygonEditor;if(this.editingMidTipMarkerListPath){if(typeof this.editingMidTipMarkerListPath=="function")return this.editingMidTipMarkerListPath(this.polygonEditor);if(typeof this.editingMidTipMarkerListPath=="string")return ae(this.polygonEditor,this.editingMidTipMarkerListPath)}return(n=this.polygonEditor.editingMidTipMarkerList)!=null&&n.length?this.polygonEditor.editingMidTipMarkerList:e?(o=e==null?void 0:e.list)==null?void 0:o.editingMidTipMarkerList:[]}getPolygonEditorTargetTotalPaths(){const e=this.getPolygonEditorTargetPaths(),n=this.getEditingMidTipMarkerList();let o=0;const i=[],r=e.length;for(;o<r;){i.push(e[o]);const s=n[o];s&&i.push(s.getCenter()),o++}return i}start(e){var i,r,s;if(!e&&!this.polygonEditor)throw new Error("polygonEditor not found");this.polygonEditor=e;const{controlPoint:n,midControlPoint:o}=this.polygonEditor;return this.polygonPaths=this.getPolygonEditorTargetPaths(),this.circleMarkers.setOptions(n).createCircleMarkersByPaths(this.polygonPaths),this.polygonTotalPaths=this.getPolygonEditorTargetTotalPaths(),this.midCircleMarkers.setOptions(o).createCircleMarkersByPaths(this.polygonTotalPaths),this.lines.createLinesByPaths(this.polygonPaths),(i=this.polygonEditor)==null||i.on("adjust",this.onPolygonEditorAdjust),(r=this.polygonEditor)==null||r.on("removenode",this.onPolygonEditorAdjust),(s=this.polygonEditor)==null||s.on("addnode",this.onPolygonEditorAdjust),this.map.on("mousedown",this.onMouseDown),this.map.on("mousemove",this.onMovePolygonEditorPoint),this.map.on("mousemove",this.onMovePolygonEditorMidPoint),this.map.on("mousemove",this.onInPolygonEditorLine),this.map.on("mouseup",this.onMouseUp),this}stop(){var e,n,o;(e=this.polygonEditor)==null||e.off("adjust",this.onPolygonEditorAdjust),(n=this.polygonEditor)==null||n.off("removenode",this.onPolygonEditorAdjust),(o=this.polygonEditor)==null||o.off("addnode",this.onPolygonEditorAdjust),this.map.off("mousedown",this.onMouseDown),this.map.off("mousemove",this.onMovePolygonEditorPoint),this.map.off("mousemove",this.onMovePolygonEditorMidPoint),this.map.off("mousemove",this.onInPolygonEditorLine),this.map.off("mouseup",this.onMouseUp)}startLineRanging(e){if(!e)throw new Error("polygonEditor not found");this.polygon||(this.polygon=e,this.lines.createLinesByPaths(this.polygon.getPath()),this.map.on("mousemove",this.onInPolygonEditorLine))}stopLineRanging(){this.map.off("mousemove",this.onInPolygonEditorLine)}setPosition(e,n){this.startPosition=e,this.lastPosition=n,this.createDistanceText()}createDistanceText(){this.startPointToCursorText&&this.lastPointToCursorText||(this.startPointToCursorText=T(),this.lastPointToCursorText=T(),this.startPointToCursorText.setMap(this.map),this.lastPointToCursorText.setMap(this.map))}updateDistanceText(e,{text:n,textPos:o}){e.setText(n),e.setPosition(o)}removeLineDistanceText(){var e;(e=this.lineLengthText)==null||e.remove(),this.lineLengthText=null}removeDistanceText(){var e,n;(e=this.startPointToCursorText)==null||e.remove(),(n=this.lastPointToCursorText)==null||n.remove(),this.startPointToCursorText=null,this.lastPointToCursorText=null}reset(){return this.startPosition=null,this.lastPosition=null,this.removeDistanceText(),this.removeLineDistanceText(),this}destroy(){return console.log("=== 销毁 围栏编辑测距事件 =="),this.reset(),this.stop(),this.circleMarkers.destroy(),this}destroyLineRanging(){return console.log("=== 销毁 围栏查看测距事件 =="),this.polygon=null,this.startPosition=null,this.lastPosition=null,this.removeLineDistanceText(),this.stopLineRanging(),this}}class Re{constructor(e){a(this,"map");a(this,"lines",null);a(this,"polygon",null);a(this,"lineLengthText",null);a(this,"editingMidTipMarkerListPath",null);a(this,"onPolygonRanging",e=>{const n=e.lnglat,o=this.lines.getPointInPolyline(n);if(!o)return this.removeLineDistanceText();const[i,r]=o;this.lineLengthText||(this.lineLengthText=T(),this.lineLengthText.add(this.map)),this.updateDistanceText(this.lineLengthText,z(i,r))});if(!e)throw new Error("map not found!");this.map=e,this.lines=new Ie(this.map)}start(e){if(!e)throw new Error("polygon not found");this.polygon||(this.polygon=e,this.lines.createLinesByPaths(this.polygon.getPath()),this.map.on("mousemove",this.onPolygonRanging))}stop(){this.map.off("mousemove",this.onPolygonRanging)}updateDistanceText(e,{text:n,textPos:o}){e.setText(n),e.setPosition(o)}removeLineDistanceText(){var e;(e=this.lineLengthText)==null||e.remove(),this.lineLengthText=null}destroy(){return this.polygon=null,this.stop(),this.removeLineDistanceText(),this}}class Ks{constructor(){a(this,"events",{})}getEvents(e){return this.events[e]||(this.events[e]=[]),this.events[e]}emit(e,...n){this.getEvents(e).forEach(i=>i(...n))}on(e,n){!e||typeof e!="string"||this.getEvents(e).push(n)}once(e,n){if(!e||typeof e!="string")return;const o=i=>{n(i),this.off(e,o)};this.on(e,o)}off(e,n){!e||typeof e!="string"||(this.events[e]=this.getEvents(e).filter(o=>o!==n))}hasEvents(e,n){return!!this.getEvents(e).find(o=>o===n)}clearEvents(e){e?this.events[e]=[]:this.events={}}}class Be extends Ks{constructor(n){super();a(this,"map");a(this,"circleMarkers",null);a(this,"polygonEditor",null);a(this,"polygonTotalPaths",[]);a(this,"circleMarker",null);a(this,"editingMidTipMarkerListPath",null);a(this,"onPolygonEditorAdjust",()=>{Promise.resolve().then(()=>{this.polygonTotalPaths=this.getPolygonEditorTargetTotalPaths(),this.circleMarkers.createCircleMarkersByPaths(this.polygonTotalPaths)})});a(this,"onMouseDown",n=>{const o=n.lnglat;this.circleMarker=this.circleMarkers.getPointInCircleMarkers(o),!(!this.circleMarker||!this.getEvents("mousedown").length)&&this.emit("mousedown",this.circleMarker)});a(this,"onMouseMove",n=>{!this.circleMarker||!this.getEvents("mousemove").length||this.emit("mousemove",this.circleMarker,n)});a(this,"onMouseUp",()=>{!this.getEvents("mouseup").length||!this.circleMarker||(this.emit("mouseup",this.circleMarker),this.circleMarker=null)});this.map=n.map,this.polygonEditor=n,this.circleMarkers=new xt(this.map),this.start(this.polygonEditor)}getPolygonEditorTargetPaths(){var n;return this.polygonEditor?(n=this.polygonEditor.getTarget().getPath())!=null?n:[]:[]}setEditingMidTipMarkerListPath(n){return this.editingMidTipMarkerListPath=n,this}getEditingMidTipMarkerList(){var o,i;const{singleRingListHandle:n}=this.polygonEditor;if(this.editingMidTipMarkerListPath){if(typeof this.editingMidTipMarkerListPath=="function")return this.editingMidTipMarkerListPath(this.polygonEditor);if(typeof this.editingMidTipMarkerListPath=="string")return ae(this.polygonEditor,this.editingMidTipMarkerListPath)}return(o=this.polygonEditor.editingMidTipMarkerList)!=null&&o.length?this.polygonEditor.editingMidTipMarkerList:n?(i=n==null?void 0:n.list)==null?void 0:i.editingMidTipMarkerList:[]}getPolygonEditorTargetTotalPaths(){const n=this.getPolygonEditorTargetPaths(),o=this.getEditingMidTipMarkerList();let i=0;const r=[],s=n.length;for(;i<s;){r.push(n[i]);const l=o[i];l&&r.push(l.getCenter()),i++}return r}start(n){var i,r,s;if(!n&&!this.polygonEditor)throw new Error("polygonEditor not found");this.polygonEditor=n;const{midControlPoint:o}=this.polygonEditor;return this.polygonTotalPaths=this.getPolygonEditorTargetTotalPaths(),this.circleMarkers.setOptions(o).createCircleMarkersByPaths(this.polygonTotalPaths),(i=this.polygonEditor)==null||i.on("adjust",this.onPolygonEditorAdjust),(r=this.polygonEditor)==null||r.on("removenode",this.onPolygonEditorAdjust),(s=this.polygonEditor)==null||s.on("addnode",this.onPolygonEditorAdjust),this.map.on("mousedown",this.onMouseDown),this.map.on("mousemove",this.onMouseMove),this.map.on("mouseup",this.onMouseUp),this}stop(){this.map.off("mousedown",this.onMouseDown),this.map.off("mousemove",this.onMouseMove),this.map.off("mouseup",this.onMouseUp)}destroy(){return this.stop(),this.circleMarkers.destroy(),this}}class Fe{constructor(e){a(this,"opts");a(this,"map");a(this,"width");a(this,"height");a(this,"center");a(this,"leftTop");a(this,"rightTop");a(this,"leftBottom");a(this,"rightBottom");a(this,"likeRectangle");return this.bindOptsToSelf(e),e.path||this.setPoints(),this.create()}bindOptsToSelf(e){this.opts=e,Object.entries(e).forEach(([n,o])=>{this[n]=o})}calcPoints(e){const[n,o]=e||this.center,i=new AMap.LngLat(n,o),r=Math.floor(this.width/2),s=Math.floor(this.height/2),l=i.offset(-r/2,s/2),h=i.offset(r/2,s/2),u=i.offset(-r/2,-s/2),y=i.offset(r/2,-s/2);return{leftTop:[l.lng,l.lat],rightTop:[h.lng,h.lat],leftBottom:[u.lng,u.lat],rightBottom:[y.lng,y.lat]}}setCenter(e){this.likeRectangle.likeRectangleCenter=this.center=e}setPoints(){const{leftTop:e,rightTop:n,leftBottom:o,rightBottom:i}=this.calcPoints();this.leftTop=e,this.rightTop=n,this.leftBottom=o,this.rightBottom=i}create(){var n,o,i;const e=((n=this.opts)==null?void 0:n.path)||[this.leftTop,this.rightTop,this.rightBottom,this.leftBottom];if(this.likeRectangle=new AMap.Polygon,this.likeRectangle.setOptions(_({path:e},this.opts)),this.enhanceProperty(),this.registryEvent(),(o=this.opts)!=null&&o.path){const[r,s,l,h]=(i=this.opts)==null?void 0:i.path;this.updatePoints(r,s,l,h)}return this.likeRectangle}enhanceProperty(){this.likeRectangle.likeRectangle=this,this.likeRectangle.leftTop=this.leftTop,this.likeRectangle.rightTop=this.rightTop,this.likeRectangle.rightBottom=this.rightBottom,this.likeRectangle.leftBottom=this.leftBottom,this.likeRectangle.likeRectangleCenter=this.center}registryEvent(){this.likeRectangle&&(this.onDragEnd=this.onDragEnd.bind(this),this.likeRectangle.on("dragend",this.onDragEnd))}onDragEnd(e){const o=e.target.getPath(),[i,r,s,l]=o;this.updatePoints(i,r,s,l)}updatePoints(e,n,o,i){this.likeRectangle.leftTop=this.leftTop=e,this.likeRectangle.rightTop=this.rightTop=n,this.likeRectangle.rightBottom=this.rightBottom=o,this.likeRectangle.leftBottom=this.leftBottom=i,this.setCenter(this.getCenter())}getCenter(){var n;return(n=this.map.getFitZoomAndCenterByOverlays([this.likeRectangle]))==null?void 0:n.pop()}}const Et=10;class Vs{constructor(e,n,o){a(this,"point");a(this,"points");a(this,"center");a(this,"context");a(this,"isEnabled",!1);this.context=e,this.point=n,this.points=o,this.init(),this.clearClientEvent()}get len(){return this.points.length-1}get extData(){return this.point.getExtData()}get idx(){return this.extData.idx}get map(){return this.context.map}get xAxisMax(){return document.body.clientWidth}get yAxisMax(){return document.body.clientHeight}enable(){this.isEnabled||(this.isEnabled=!0,this.setCursorPointer("move"),this.registryEvent())}disable(){this.isEnabled=!1,this.setCursorPointer("pointer"),this.destroyEvent()}setCursorPointer(e){var n;(n=this.point)==null||n.setOptions({cursor:e})}init(){this.center=this.point.getCenter(),this.onMouseOver=this.onMouseOver.bind(this),this.onMouseOut=this.onMouseOut.bind(this),this.onDragStart=this.onDragStart.bind(this),this.onDragging=Ws(this.onDragging.bind(this),100),this.onDragEnd=this.onDragEnd.bind(this),this.defaultRegistryEvent()}clearClientEvent(){this.point.clearEvents("click")}defaultRegistryEvent(){this.point.on("mouseover",this.onMouseOver),this.point.on("mouseout",this.onMouseOut)}registryEvent(){this.point.on("dragstart",this.onDragStart),this.point.on("dragend",this.onDragEnd),console.log("注册完成")}destroyEvent(){this.point.off("dragstart",this.onDragStart),this.point.off("dragend",this.onDragEnd)}onMouseOver(){console.log(`点位${this.extData.idx} 移入`),this.enable()}onMouseOut(){console.log(`点位${this.extData.idx} 移出`),this.disable()}onDragStart(e){console.log(`点位${this.extData.idx} 移动开始`),Mt(this.context.onChange,Et,e)}onDragging(e){const{pixel:n}=e;this.updateNextLeftPoint(n,e),this.updateNextRightPoint(n,e),Mt(this.context.onChange,Et,e)}onDragEnd(e){const{target:n,pixel:o}=e;this.updateNextLeftPoint(o,e),this.updateNextRightPoint(o,e),this.center=n.getCenter(),Mt(this.context.onChange,Et,e)}updateNextLeftPoint(e,n){const o=this.idx-1>=0?this.idx-1:this.len,i=this.points[o],r=this.map.lngLatToContainer(i.getCenter()),s=this.map.lngLatToContainer(this.center),l=(s.y-r.y)/(s.x-r.x),h=s.y-l*s.x,u=o-1>=0?o-1:this.len,y=this.points[u],b=this.map.lngLatToContainer(y.getCenter()),P=-1/l;let p=b.y-P*b.x;const w=r.y-P*r.x-p;console.log("updateNextLeftPoint 验证",w),Math.abs(w)>=.1&&(console.log("=== updateNextLeftPoint 矫正 b2 值 ==="),console.log(`矫正前 b2 = ${p}`),p+=w,console.log(`矫正后 b2 = ${p}`),console.log("updateNextLeftPoint 矫正后验证",r.y-P*r.x-p));const C=l,v=e.y-C*e.x;let M=[],x=0;for(;x<this.xAxisMax;){const U=P*x+p,E=U-C*x-v;if(-2<=E&&E<=2)if(M.push(E),-.01<=E&&E<=.01){console.log("updateNextLeftPoint.val ===>",E);const G=new AMap.Pixel(x,U);this.dispatch(i,G,n.originEvent);break}else x+=.005;else x+=.5}x>=this.xAxisMax&&(console.log(M),console.error("updateNextLeftPoint ===> 未找到交点"),console.log("k1 ===>",l),console.log("b1 ===>",h),console.log("验证",r.y-l*r.x-h),console.log("k2 ===>",P),console.log("b2 ===>",p),console.log("验证",r.y-P*r.x-p),console.log("k3 ===>",C),console.log("b3 ===>",v))}updateNextRightPoint(e,n){const o=this.idx+1<=this.len?this.idx+1:0,i=this.points[o],r=this.map.lngLatToContainer(i.getCenter()),s=this.map.lngLatToContainer(this.center),l=(s.y-r.y)/(s.x-r.x),h=s.y-l*s.x,u=o+1<=this.len?o+1:0,y=this.points[u],b=this.map.lngLatToContainer(y.getCenter()),P=-1/l;let p=b.y-P*b.x;const w=r.y-P*r.x-p;console.log("updateNextRightPoint 验证",w),Math.abs(w)>=.01&&(console.log("=== updateNextRightPoint 矫正 b2 值 ==="),console.log(`矫正前 b2 = ${p}`),p+=w,console.log(`矫正后 b2 = ${p}`));const C=l,v=e.y-C*e.x,M=[];let x=0;for(;x<this.xAxisMax;){const U=P*x+p,E=U-C*x-v;if(-2<E&&E<2)if(M.push(E),-.01<=E&&E<=.01){console.log("updateNextRightPoint.val ===>",E);const G=new AMap.Pixel(x,U);this.dispatch(i,G,n.originEvent);break}else x+=.005;else x+=.5}x>=this.xAxisMax&&(console.log(M),console.error("updateNextRightPoint ===> 未找到交点"),console.log("k1 ===>",l),console.log("b1 ===>",h),console.log("验证",r.y-l*r.x-h),console.log("k2 ===>",P),console.log("b2 ===>",p),console.log("验证",r.y-P*r.x-p),console.log("k3 ===>",C),console.log("b3 ===>",v),console.log("验证",e.y-C*e.x-v))}dispatch(e,n,o){const r={lnglat:this.map.containerToLngLat(n),originEvent:o};e.emit("dragend",r)}}class Ne{constructor(e,n,o){a(this,"opts");a(this,"map");a(this,"likeRectangle");a(this,"polygonEditor");a(this,"polygonEditorOpen");a(this,"controlPoints");return this.map=e,this.likeRectangle=n,this.opts=o,this.onChange=this.onChange.bind(this),this.createEditor()}get options(){return $t(_({},this.opts),{midControlPoint:{radius:0}})}open(){this.polygonEditorOpen(),this.controlPointRegistryEvent()}findControlPoint(e){return this.controlPoints.find(n=>{const o=n.point.getCenter(),i=`${o.lng}_${o.lat}`,r=e.getCenter(),s=`${r.lng}_${r.lat}`;return i===s})}createEditor(){const e=this.likeRectangle;return this.polygonEditor=new AMap.PolygonEditor(this.map,e,this.options),this.enhanceProperty(),this.polygonEditor}enhanceProperty(){this.polygonEditor.likeRectangleEditor=this,this.polygonEditorOpen=this.polygonEditor.open,this.polygonEditor.open=this.open.bind(this)}controlPointRegistryEvent(){var n,o,i,r;const e=(r=(i=(o=(n=this.polygonEditor)==null?void 0:n.singleRingListHandle)==null?void 0:o.list)==null?void 0:i.editingVertexMarkerList)!=null?r:[];this.controlPoints=e.map((s,l)=>{const h=s.getExtData()||{};return s.setExtData($t(_({},h),{idx:l})),new Vs(this,s,e)})}onChange(){var e,n;this.updateCenterMarker(),this.updateLikeRectanglePath(),(n=(e=this.opts).onChange)==null||n.call(e)}updateCenterMarker(){}updateLikeRectanglePath(){const[e,n,o,i]=this.controlPoints,r=e.point.getCenter(),s=n.point.getCenter(),l=o.point.getCenter(),h=i.point.getCenter();this.likeRectangle.likeRectangle.updatePoints([r.lng,r.lat],[s.lng,s.lat],[l.lng,l.lat],[h.lng,h.lat])}}const Ys={PolygonRangingInDrawing:wt,PolygonEditorRanging:De,PolygonEditorEvent:Be,PolygonRanging:Re,LikeRectangle:Fe,LikeRectangleEditor:Ne};c.LikeRectangle=Fe,c.LikeRectangleEditor=Ne,c.PolygonEditorEvent=Be,c.PolygonEditorRanging=De,c.PolygonRanging=Re,c.PolygonRangingInDrawing=wt,c.default=Ys,Object.defineProperties(c,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})});
