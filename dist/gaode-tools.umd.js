(function(c,p){typeof exports=="object"&&typeof module<"u"?p(exports):typeof define=="function"&&define.amd?define(["exports"],p):(c=typeof globalThis<"u"?globalThis:c||self,p(c["gaode-tools"]={}))})(this,function(c){"use strict";var ls=Object.defineProperty;var cs=(c,p,d)=>p in c?ls(c,p,{enumerable:!0,configurable:!0,writable:!0,value:d}):c[p]=d;var s=(c,p,d)=>(cs(c,typeof p!="symbol"?p+"":p,d),d);const p={"border-color":"#e1f5fe","font-size":"12px","border-radius":".25rem","background-color":"rgba(0,0,0,.4)","border-width":0,"text-align":"center",color:"#fff"},d=(t="",e={})=>new AMap.Text({text:t,style:{...p,...e},offset:[0,-10]}),O=(t,e)=>{const n=t.divideBy(2).add(e.divideBy(2));return{text:`${Math.round(t.distance(e))}米`,textPos:n}};let lt=class{constructor(e){s(this,"map");s(this,"startPointToCursorText",null);s(this,"lastPointToCursorText",null);s(this,"startPosition",null);s(this,"lastPosition",null);s(this,"getClickPosition",e=>{const n=e.lnglat;this.startPosition?this.startPosition&&(this.lastPosition=n,this.createDistanceText()):this.startPosition=n});s(this,"onMouseMoveInDrawPolygon",e=>{if(!this.startPosition||!this.lastPosition)return;const n=e.lnglat;this.updateDistanceText(this.startPointToCursorText,O(this.startPosition,n)),this.updateDistanceText(this.lastPointToCursorText,O(this.lastPosition,n))});if(!e)throw new Error("map not found!");this.map=e}start(){this.map.on("click",this.getClickPosition),this.map.on("mousemove",this.onMouseMoveInDrawPolygon)}stop(){this.map.off("click",this.getClickPosition),this.map.off("mousemove",this.onMouseMoveInDrawPolygon)}createDistanceText(){this.startPointToCursorText&&this.lastPointToCursorText||(this.startPointToCursorText=d(),this.startPointToCursorText.setMap(this.map),this.lastPointToCursorText=d(),this.lastPointToCursorText.setMap(this.map))}updateDistanceText(e,{text:n,textPos:r}){e.setText(n),e.setPosition(r)}removeDistanceText(){var e,n;(e=this.startPointToCursorText)==null||e.remove(),this.startPointToCursorText=null,(n=this.lastPointToCursorText)==null||n.remove(),this.lastPointToCursorText=null}reset(){return this.startPosition=null,this.lastPosition=null,this.removeDistanceText(),this}destroy(){return this.reset(),this.stop(),this}};var Pe=typeof global=="object"&&global&&global.Object===Object&&global;const ct=Pe;var me=typeof self=="object"&&self&&self.Object===Object&&self,be=ct||me||Function("return this")();const T=be;var ve=T.Symbol;const P=ve;var ut=Object.prototype,Me=ut.hasOwnProperty,$e=ut.toString,L=P?P.toStringTag:void 0;function _e(t){var e=Me.call(t,L),n=t[L];try{t[L]=void 0;var r=!0}catch{}var o=$e.call(t);return r&&(e?t[L]=n:delete t[L]),o}var we=Object.prototype,Ce=we.toString;function xe(t){return Ce.call(t)}var je="[object Null]",Ee="[object Undefined]",ht=P?P.toStringTag:void 0;function M(t){return t==null?t===void 0?Ee:je:ht&&ht in Object(t)?_e(t):xe(t)}function $(t){return t!=null&&typeof t=="object"}var Oe="[object Symbol]";function K(t){return typeof t=="symbol"||$(t)&&M(t)==Oe}function ft(t,e){for(var n=-1,r=t==null?0:t.length,o=Array(r);++n<r;)o[n]=e(t[n],n,t);return o}var Ae=Array.isArray;const _=Ae;var Se=1/0,gt=P?P.prototype:void 0,pt=gt?gt.toString:void 0;function dt(t){if(typeof t=="string")return t;if(_(t))return ft(t,dt)+"";if(K(t))return pt?pt.call(t):"";var e=t+"";return e=="0"&&1/t==-Se?"-0":e}function D(t){var e=typeof t;return t!=null&&(e=="object"||e=="function")}function Ie(t){return t}var Le="[object AsyncFunction]",De="[object Function]",ke="[object GeneratorFunction]",Fe="[object Proxy]";function yt(t){if(!D(t))return!1;var e=M(t);return e==De||e==ke||e==Le||e==Fe}var Be=T["__core-js_shared__"];const H=Be;var Tt=function(){var t=/[^.]+$/.exec(H&&H.keys&&H.keys.IE_PROTO||"");return t?"Symbol(src)_1."+t:""}();function Re(t){return!!Tt&&Tt in t}var Ue=Function.prototype,Ne=Ue.toString;function w(t){if(t!=null){try{return Ne.call(t)}catch{}try{return t+""}catch{}}return""}var Ge=/[\\^$.*+?()[\]{}|]/g,ze=/^\[object .+?Constructor\]$/,Ke=Function.prototype,He=Object.prototype,Ve=Ke.toString,We=He.hasOwnProperty,Ye=RegExp("^"+Ve.call(We).replace(Ge,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");function Xe(t){if(!D(t)||Re(t))return!1;var e=yt(t)?Ye:ze;return e.test(w(t))}function qe(t,e){return t==null?void 0:t[e]}function C(t,e){var n=qe(t,e);return Xe(n)?n:void 0}var Ze=C(T,"WeakMap");const V=Ze;var Pt=Object.create,Je=function(){function t(){}return function(e){if(!D(e))return{};if(Pt)return Pt(e);t.prototype=e;var n=new t;return t.prototype=void 0,n}}();const Qe=Je;function tn(t,e,n){switch(n.length){case 0:return t.call(e);case 1:return t.call(e,n[0]);case 2:return t.call(e,n[0],n[1]);case 3:return t.call(e,n[0],n[1],n[2])}return t.apply(e,n)}function en(t,e){var n=-1,r=t.length;for(e||(e=Array(r));++n<r;)e[n]=t[n];return e}var nn=800,rn=16,on=Date.now;function sn(t){var e=0,n=0;return function(){var r=on(),o=rn-(r-n);if(n=r,o>0){if(++e>=nn)return arguments[0]}else e=0;return t.apply(void 0,arguments)}}function an(t){return function(){return t}}var ln=function(){try{var t=C(Object,"defineProperty");return t({},"",{}),t}catch{}}();const U=ln;var cn=U?function(t,e){return U(t,"toString",{configurable:!0,enumerable:!1,value:an(e),writable:!0})}:Ie,un=sn(cn);const hn=un;function fn(t,e){for(var n=-1,r=t==null?0:t.length;++n<r&&e(t[n],n,t)!==!1;);return t}var gn=9007199254740991,pn=/^(?:0|[1-9]\d*)$/;function dn(t,e){var n=typeof t;return e=e??gn,!!e&&(n=="number"||n!="symbol"&&pn.test(t))&&t>-1&&t%1==0&&t<e}function mt(t,e,n){e=="__proto__"&&U?U(t,e,{configurable:!0,enumerable:!0,value:n,writable:!0}):t[e]=n}function bt(t,e){return t===e||t!==t&&e!==e}var yn=Object.prototype,Tn=yn.hasOwnProperty;function vt(t,e,n){var r=t[e];(!(Tn.call(t,e)&&bt(r,n))||n===void 0&&!(e in t))&&mt(t,e,n)}function k(t,e,n,r){var o=!n;n||(n={});for(var i=-1,a=e.length;++i<a;){var l=e[i],f=r?r(n[l],t[l],l,n,t):void 0;f===void 0&&(f=t[l]),o?mt(n,l,f):vt(n,l,f)}return n}var Mt=Math.max;function Pn(t,e,n){return e=Mt(e===void 0?t.length-1:e,0),function(){for(var r=arguments,o=-1,i=Mt(r.length-e,0),a=Array(i);++o<i;)a[o]=r[e+o];o=-1;for(var l=Array(e+1);++o<e;)l[o]=r[o];return l[e]=n(a),tn(t,this,l)}}var mn=9007199254740991;function $t(t){return typeof t=="number"&&t>-1&&t%1==0&&t<=mn}function _t(t){return t!=null&&$t(t.length)&&!yt(t)}var bn=Object.prototype;function W(t){var e=t&&t.constructor,n=typeof e=="function"&&e.prototype||bn;return t===n}function vn(t,e){for(var n=-1,r=Array(t);++n<t;)r[n]=e(n);return r}var Mn="[object Arguments]";function wt(t){return $(t)&&M(t)==Mn}var Ct=Object.prototype,$n=Ct.hasOwnProperty,_n=Ct.propertyIsEnumerable,wn=wt(function(){return arguments}())?wt:function(t){return $(t)&&$n.call(t,"callee")&&!_n.call(t,"callee")};const xt=wn;function Cn(){return!1}var jt=typeof c=="object"&&c&&!c.nodeType&&c,Et=jt&&typeof module=="object"&&module&&!module.nodeType&&module,xn=Et&&Et.exports===jt,Ot=xn?T.Buffer:void 0,jn=Ot?Ot.isBuffer:void 0,En=jn||Cn;const At=En;var On="[object Arguments]",An="[object Array]",Sn="[object Boolean]",In="[object Date]",Ln="[object Error]",Dn="[object Function]",kn="[object Map]",Fn="[object Number]",Bn="[object Object]",Rn="[object RegExp]",Un="[object Set]",Nn="[object String]",Gn="[object WeakMap]",zn="[object ArrayBuffer]",Kn="[object DataView]",Hn="[object Float32Array]",Vn="[object Float64Array]",Wn="[object Int8Array]",Yn="[object Int16Array]",Xn="[object Int32Array]",qn="[object Uint8Array]",Zn="[object Uint8ClampedArray]",Jn="[object Uint16Array]",Qn="[object Uint32Array]",h={};h[Hn]=h[Vn]=h[Wn]=h[Yn]=h[Xn]=h[qn]=h[Zn]=h[Jn]=h[Qn]=!0,h[On]=h[An]=h[zn]=h[Sn]=h[Kn]=h[In]=h[Ln]=h[Dn]=h[kn]=h[Fn]=h[Bn]=h[Rn]=h[Un]=h[Nn]=h[Gn]=!1;function tr(t){return $(t)&&$t(t.length)&&!!h[M(t)]}function Y(t){return function(e){return t(e)}}var St=typeof c=="object"&&c&&!c.nodeType&&c,F=St&&typeof module=="object"&&module&&!module.nodeType&&module,er=F&&F.exports===St,X=er&&ct.process,nr=function(){try{var t=F&&F.require&&F.require("util").types;return t||X&&X.binding&&X.binding("util")}catch{}}();const A=nr;var It=A&&A.isTypedArray,rr=It?Y(It):tr;const or=rr;var ir=Object.prototype,sr=ir.hasOwnProperty;function Lt(t,e){var n=_(t),r=!n&&xt(t),o=!n&&!r&&At(t),i=!n&&!r&&!o&&or(t),a=n||r||o||i,l=a?vn(t.length,String):[],f=l.length;for(var g in t)(e||sr.call(t,g))&&!(a&&(g=="length"||o&&(g=="offset"||g=="parent")||i&&(g=="buffer"||g=="byteLength"||g=="byteOffset")||dn(g,f)))&&l.push(g);return l}function Dt(t,e){return function(n){return t(e(n))}}var ar=Dt(Object.keys,Object);const lr=ar;var cr=Object.prototype,ur=cr.hasOwnProperty;function hr(t){if(!W(t))return lr(t);var e=[];for(var n in Object(t))ur.call(t,n)&&n!="constructor"&&e.push(n);return e}function q(t){return _t(t)?Lt(t):hr(t)}function fr(t){var e=[];if(t!=null)for(var n in Object(t))e.push(n);return e}var gr=Object.prototype,pr=gr.hasOwnProperty;function dr(t){if(!D(t))return fr(t);var e=W(t),n=[];for(var r in t)r=="constructor"&&(e||!pr.call(t,r))||n.push(r);return n}function Z(t){return _t(t)?Lt(t,!0):dr(t)}var yr=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,Tr=/^\w*$/;function Pr(t,e){if(_(t))return!1;var n=typeof t;return n=="number"||n=="symbol"||n=="boolean"||t==null||K(t)?!0:Tr.test(t)||!yr.test(t)||e!=null&&t in Object(e)}var mr=C(Object,"create");const B=mr;function br(){this.__data__=B?B(null):{},this.size=0}function vr(t){var e=this.has(t)&&delete this.__data__[t];return this.size-=e?1:0,e}var Mr="__lodash_hash_undefined__",$r=Object.prototype,_r=$r.hasOwnProperty;function wr(t){var e=this.__data__;if(B){var n=e[t];return n===Mr?void 0:n}return _r.call(e,t)?e[t]:void 0}var Cr=Object.prototype,xr=Cr.hasOwnProperty;function jr(t){var e=this.__data__;return B?e[t]!==void 0:xr.call(e,t)}var Er="__lodash_hash_undefined__";function Or(t,e){var n=this.__data__;return this.size+=this.has(t)?0:1,n[t]=B&&e===void 0?Er:e,this}function x(t){var e=-1,n=t==null?0:t.length;for(this.clear();++e<n;){var r=t[e];this.set(r[0],r[1])}}x.prototype.clear=br,x.prototype.delete=vr,x.prototype.get=wr,x.prototype.has=jr,x.prototype.set=Or;function Ar(){this.__data__=[],this.size=0}function N(t,e){for(var n=t.length;n--;)if(bt(t[n][0],e))return n;return-1}var Sr=Array.prototype,Ir=Sr.splice;function Lr(t){var e=this.__data__,n=N(e,t);if(n<0)return!1;var r=e.length-1;return n==r?e.pop():Ir.call(e,n,1),--this.size,!0}function Dr(t){var e=this.__data__,n=N(e,t);return n<0?void 0:e[n][1]}function kr(t){return N(this.__data__,t)>-1}function Fr(t,e){var n=this.__data__,r=N(n,t);return r<0?(++this.size,n.push([t,e])):n[r][1]=e,this}function m(t){var e=-1,n=t==null?0:t.length;for(this.clear();++e<n;){var r=t[e];this.set(r[0],r[1])}}m.prototype.clear=Ar,m.prototype.delete=Lr,m.prototype.get=Dr,m.prototype.has=kr,m.prototype.set=Fr;var Br=C(T,"Map");const R=Br;function Rr(){this.size=0,this.__data__={hash:new x,map:new(R||m),string:new x}}function Ur(t){var e=typeof t;return e=="string"||e=="number"||e=="symbol"||e=="boolean"?t!=="__proto__":t===null}function G(t,e){var n=t.__data__;return Ur(e)?n[typeof e=="string"?"string":"hash"]:n.map}function Nr(t){var e=G(this,t).delete(t);return this.size-=e?1:0,e}function Gr(t){return G(this,t).get(t)}function zr(t){return G(this,t).has(t)}function Kr(t,e){var n=G(this,t),r=n.size;return n.set(t,e),this.size+=n.size==r?0:1,this}function b(t){var e=-1,n=t==null?0:t.length;for(this.clear();++e<n;){var r=t[e];this.set(r[0],r[1])}}b.prototype.clear=Rr,b.prototype.delete=Nr,b.prototype.get=Gr,b.prototype.has=zr,b.prototype.set=Kr;var Hr="Expected a function";function J(t,e){if(typeof t!="function"||e!=null&&typeof e!="function")throw new TypeError(Hr);var n=function(){var r=arguments,o=e?e.apply(this,r):r[0],i=n.cache;if(i.has(o))return i.get(o);var a=t.apply(this,r);return n.cache=i.set(o,a)||i,a};return n.cache=new(J.Cache||b),n}J.Cache=b;var Vr=500;function Wr(t){var e=J(t,function(r){return n.size===Vr&&n.clear(),r}),n=e.cache;return e}var Yr=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,Xr=/\\(\\)?/g,qr=Wr(function(t){var e=[];return t.charCodeAt(0)===46&&e.push(""),t.replace(Yr,function(n,r,o,i){e.push(o?i.replace(Xr,"$1"):r||n)}),e});const Zr=qr;function Jr(t){return t==null?"":dt(t)}function Q(t,e){return _(t)?t:Pr(t,e)?[t]:Zr(Jr(t))}var Qr=1/0;function kt(t){if(typeof t=="string"||K(t))return t;var e=t+"";return e=="0"&&1/t==-Qr?"-0":e}function Ft(t,e){e=Q(e,t);for(var n=0,r=e.length;t!=null&&n<r;)t=t[kt(e[n++])];return n&&n==r?t:void 0}function to(t,e,n){var r=t==null?void 0:Ft(t,e);return r===void 0?n:r}function tt(t,e){for(var n=-1,r=e.length,o=t.length;++n<r;)t[o+n]=e[n];return t}var Bt=P?P.isConcatSpreadable:void 0;function eo(t){return _(t)||xt(t)||!!(Bt&&t&&t[Bt])}function Rt(t,e,n,r,o){var i=-1,a=t.length;for(n||(n=eo),o||(o=[]);++i<a;){var l=t[i];e>0&&n(l)?e>1?Rt(l,e-1,n,r,o):tt(o,l):r||(o[o.length]=l)}return o}function no(t){var e=t==null?0:t.length;return e?Rt(t,1):[]}function ro(t){return hn(Pn(t,void 0,no),t+"")}var oo=Dt(Object.getPrototypeOf,Object);const et=oo;var io="[object Object]",so=Function.prototype,ao=Object.prototype,Ut=so.toString,lo=ao.hasOwnProperty,co=Ut.call(Object);function uo(t){if(!$(t)||M(t)!=io)return!1;var e=et(t);if(e===null)return!0;var n=lo.call(e,"constructor")&&e.constructor;return typeof n=="function"&&n instanceof n&&Ut.call(n)==co}function ho(t,e,n){var r=-1,o=t.length;e<0&&(e=-e>o?0:o+e),n=n>o?o:n,n<0&&(n+=o),o=e>n?0:n-e>>>0,e>>>=0;for(var i=Array(o);++r<o;)i[r]=t[r+e];return i}function fo(){this.__data__=new m,this.size=0}function go(t){var e=this.__data__,n=e.delete(t);return this.size=e.size,n}function po(t){return this.__data__.get(t)}function yo(t){return this.__data__.has(t)}var To=200;function Po(t,e){var n=this.__data__;if(n instanceof m){var r=n.__data__;if(!R||r.length<To-1)return r.push([t,e]),this.size=++n.size,this;n=this.__data__=new b(r)}return n.set(t,e),this.size=n.size,this}function S(t){var e=this.__data__=new m(t);this.size=e.size}S.prototype.clear=fo,S.prototype.delete=go,S.prototype.get=po,S.prototype.has=yo,S.prototype.set=Po;function mo(t,e){return t&&k(e,q(e),t)}function bo(t,e){return t&&k(e,Z(e),t)}var Nt=typeof c=="object"&&c&&!c.nodeType&&c,Gt=Nt&&typeof module=="object"&&module&&!module.nodeType&&module,vo=Gt&&Gt.exports===Nt,zt=vo?T.Buffer:void 0,Kt=zt?zt.allocUnsafe:void 0;function Mo(t,e){if(e)return t.slice();var n=t.length,r=Kt?Kt(n):new t.constructor(n);return t.copy(r),r}function $o(t,e){for(var n=-1,r=t==null?0:t.length,o=0,i=[];++n<r;){var a=t[n];e(a,n,t)&&(i[o++]=a)}return i}function Ht(){return[]}var _o=Object.prototype,wo=_o.propertyIsEnumerable,Vt=Object.getOwnPropertySymbols,Co=Vt?function(t){return t==null?[]:(t=Object(t),$o(Vt(t),function(e){return wo.call(t,e)}))}:Ht;const nt=Co;function xo(t,e){return k(t,nt(t),e)}var jo=Object.getOwnPropertySymbols,Eo=jo?function(t){for(var e=[];t;)tt(e,nt(t)),t=et(t);return e}:Ht;const Wt=Eo;function Oo(t,e){return k(t,Wt(t),e)}function Yt(t,e,n){var r=e(t);return _(t)?r:tt(r,n(t))}function Ao(t){return Yt(t,q,nt)}function Xt(t){return Yt(t,Z,Wt)}var So=C(T,"DataView");const rt=So;var Io=C(T,"Promise");const ot=Io;var Lo=C(T,"Set");const it=Lo;var qt="[object Map]",Do="[object Object]",Zt="[object Promise]",Jt="[object Set]",Qt="[object WeakMap]",te="[object DataView]",ko=w(rt),Fo=w(R),Bo=w(ot),Ro=w(it),Uo=w(V),j=M;(rt&&j(new rt(new ArrayBuffer(1)))!=te||R&&j(new R)!=qt||ot&&j(ot.resolve())!=Zt||it&&j(new it)!=Jt||V&&j(new V)!=Qt)&&(j=function(t){var e=M(t),n=e==Do?t.constructor:void 0,r=n?w(n):"";if(r)switch(r){case ko:return te;case Fo:return qt;case Bo:return Zt;case Ro:return Jt;case Uo:return Qt}return e});const st=j;var No=Object.prototype,Go=No.hasOwnProperty;function zo(t){var e=t.length,n=new t.constructor(e);return e&&typeof t[0]=="string"&&Go.call(t,"index")&&(n.index=t.index,n.input=t.input),n}var Ko=T.Uint8Array;const ee=Ko;function at(t){var e=new t.constructor(t.byteLength);return new ee(e).set(new ee(t)),e}function Ho(t,e){var n=e?at(t.buffer):t.buffer;return new t.constructor(n,t.byteOffset,t.byteLength)}var Vo=/\w*$/;function Wo(t){var e=new t.constructor(t.source,Vo.exec(t));return e.lastIndex=t.lastIndex,e}var ne=P?P.prototype:void 0,re=ne?ne.valueOf:void 0;function Yo(t){return re?Object(re.call(t)):{}}function Xo(t,e){var n=e?at(t.buffer):t.buffer;return new t.constructor(n,t.byteOffset,t.length)}var qo="[object Boolean]",Zo="[object Date]",Jo="[object Map]",Qo="[object Number]",ti="[object RegExp]",ei="[object Set]",ni="[object String]",ri="[object Symbol]",oi="[object ArrayBuffer]",ii="[object DataView]",si="[object Float32Array]",ai="[object Float64Array]",li="[object Int8Array]",ci="[object Int16Array]",ui="[object Int32Array]",hi="[object Uint8Array]",fi="[object Uint8ClampedArray]",gi="[object Uint16Array]",pi="[object Uint32Array]";function di(t,e,n){var r=t.constructor;switch(e){case oi:return at(t);case qo:case Zo:return new r(+t);case ii:return Ho(t,n);case si:case ai:case li:case ci:case ui:case hi:case fi:case gi:case pi:return Xo(t,n);case Jo:return new r;case Qo:case ni:return new r(t);case ti:return Wo(t);case ei:return new r;case ri:return Yo(t)}}function yi(t){return typeof t.constructor=="function"&&!W(t)?Qe(et(t)):{}}var Ti="[object Map]";function Pi(t){return $(t)&&st(t)==Ti}var oe=A&&A.isMap,mi=oe?Y(oe):Pi;const bi=mi;var vi="[object Set]";function Mi(t){return $(t)&&st(t)==vi}var ie=A&&A.isSet,$i=ie?Y(ie):Mi;const _i=$i;var wi=1,Ci=2,xi=4,se="[object Arguments]",ji="[object Array]",Ei="[object Boolean]",Oi="[object Date]",Ai="[object Error]",ae="[object Function]",Si="[object GeneratorFunction]",Ii="[object Map]",Li="[object Number]",le="[object Object]",Di="[object RegExp]",ki="[object Set]",Fi="[object String]",Bi="[object Symbol]",Ri="[object WeakMap]",Ui="[object ArrayBuffer]",Ni="[object DataView]",Gi="[object Float32Array]",zi="[object Float64Array]",Ki="[object Int8Array]",Hi="[object Int16Array]",Vi="[object Int32Array]",Wi="[object Uint8Array]",Yi="[object Uint8ClampedArray]",Xi="[object Uint16Array]",qi="[object Uint32Array]",u={};u[se]=u[ji]=u[Ui]=u[Ni]=u[Ei]=u[Oi]=u[Gi]=u[zi]=u[Ki]=u[Hi]=u[Vi]=u[Ii]=u[Li]=u[le]=u[Di]=u[ki]=u[Fi]=u[Bi]=u[Wi]=u[Yi]=u[Xi]=u[qi]=!0,u[Ai]=u[ae]=u[Ri]=!1;function z(t,e,n,r,o,i){var a,l=e&wi,f=e&Ci,g=e&xi;if(n&&(a=o?n(t,r,o,i):n(t)),a!==void 0)return a;if(!D(t))return t;var y=_(t);if(y){if(a=zo(t),!l)return en(t,a)}else{var I=st(t),de=I==ae||I==Si;if(At(t))return Mo(t,l);if(I==le||I==se||de&&!o){if(a=f||de?{}:yi(t),!l)return f?Oo(t,bo(a,t)):xo(t,mo(a,t))}else{if(!u[I])return o?t:{};a=di(t,I,l)}}i||(i=new S);var ye=i.get(t);if(ye)return ye;i.set(t,a),_i(t)?t.forEach(function(v){a.add(z(v,e,n,v,t,i))}):bi(t)&&t.forEach(function(v,E){a.set(E,z(v,e,n,E,t,i))});var as=g?f?Xt:Ao:f?Z:q,Te=y?void 0:as(t);return fn(Te||t,function(v,E){Te&&(E=v,v=t[E]),vt(a,E,z(v,e,n,E,t,i))}),a}function Zi(t){var e=t==null?0:t.length;return e?t[e-1]:void 0}function Ji(t,e){return e.length<2?t:Ft(t,ho(e,0,-1))}function Qi(t,e){return e=Q(e,t),t=Ji(t,e),t==null||delete t[kt(Zi(e))]}function ts(t){return uo(t)?void 0:t}var es=1,ns=2,rs=4,os=ro(function(t,e){var n={};if(t==null)return n;var r=!1;e=ft(e,function(i){return i=Q(i,t),r||(r=i.length>1),i}),k(t,Xt(t),n),r&&(n=z(n,es|ns|rs,ts));for(var o=e.length;o--;)Qi(n,e[o]);return n});const is=os,ce={radius:6,zIndex:0,strokeOpacity:0,fillOpacity:0};class ue{constructor(e){s(this,"map");s(this,"options",{...ce});s(this,"circleMarkers",[]);this.map=e}setOptions(e){return this.options={...e,...is(ce,"radius")},this}createCircleMarkersByPaths(e){this.removeFromTheMap(),this.reset(),e.forEach(n=>{this.circleMarkers.push(this.createCircleMarker(n))}),this.addToMap()}createCircleMarker(e){return new AMap.CircleMarker({center:e,...this.options})}addToMap(){this.map.add(this.circleMarkers)}removeFromTheMap(){this.map.remove(this.circleMarkers)}getPointInCircleMarkers(e){return this.circleMarkers.find(n=>this.isPointInCircle(e,n))??null}getInCircleMarkersPoint(e){const n=this.circleMarkers.find(o=>this.isPointInCircle(e,o));return this.circleMarkers.findIndex(o=>o===n)%2===0?null:n??null}isPointInCircle(e,n){return n.contains(e)}reset(){this.circleMarkers=[]}destroy(){this.removeFromTheMap(),this.reset()}}const he={zIndex:1,strokeColor:"#00D3FC",strokeWeight:8,strokeOpacity:0};class fe{constructor(e){s(this,"map");s(this,"linesPath",[]);s(this,"lines",[]);if(!e)throw new Error("map not found");this.map=e}getLinesByPaths(e){let n=0;const r=e.length;for(;n<r;){const o=n+1>=r?0:n+1;this.linesPath.push([e[n],e[o]]),n++}return this.linesPath}createLinesByPaths(e){this.reset(),this.getLinesByPaths(e)}createPolyLine(e){return new AMap.Polyline({path:e,...he})}addToMap(){this.map.add(this.lines)}removeFromTheMap(){this.map.remove(this.lines)}getPointInPolyline(e){const n=this.map.getResolution(),r=he.strokeWeight*n;return this.linesPath.find(i=>AMap.GeometryUtil.isPointOnSegment(e,i[0],i[1],r))}reset(){this.linesPath=[],this.lines=[]}}class ge{constructor(e,n){s(this,"map");s(this,"circleMarkers",null);s(this,"midCircleMarkers",null);s(this,"lines",null);s(this,"polygonEditor",null);s(this,"polygonPaths",[]);s(this,"polygonTotalPaths",[]);s(this,"polygon",null);s(this,"startPointToCursorText",null);s(this,"lastPointToCursorText",null);s(this,"lineLengthText",null);s(this,"circleMarker",null);s(this,"midCircleMarker",null);s(this,"startPosition",null);s(this,"lastPosition",null);s(this,"editingMidTipMarkerListPath",null);s(this,"onPolygonEditorAdjust",({target:e})=>{this.polygonPaths=e.getPath(),this.circleMarkers.createCircleMarkersByPaths(this.polygonPaths),this.lines.createLinesByPaths(this.polygonPaths),Promise.resolve().then(()=>{this.polygonTotalPaths=this.getPolygonEditorTargetTotalPaths(),this.midCircleMarkers.createCircleMarkersByPaths(this.polygonTotalPaths)}),this.reset()});s(this,"onMouseDown",e=>{const n=e.lnglat;this.circleMarker=this.circleMarkers.getPointInCircleMarkers(n),this.midCircleMarker=this.midCircleMarkers.getInCircleMarkersPoint(n)});s(this,"onMovePolygonEditorPoint",e=>{if(this.midCircleMarker)return;if(!this.circleMarker){this.reset();return}const n=this.circleMarker.getCenter(),r=y=>`${y.lng}-${y.lat}`;let o=this.polygonPaths.findIndex(y=>r(y)===r(n));if(o===-1)return;const i=this.polygonPaths.length,a=o-1<=-1?i-1:o-1,l=o+1>=i?0:o+1,f=this.polygonPaths.at(a),g=this.polygonPaths.at(l);this.setPosition(f,g),this.onMouseMoveInDrawPolygon(e)});s(this,"onMovePolygonEditorMidPoint",e=>{if(this.circleMarker)return;if(!this.midCircleMarker){this.reset();return}const n=this.midCircleMarker.getCenter(),r=y=>`${y.lng}-${y.lat}`;let o=this.polygonTotalPaths.findIndex(y=>r(y)===r(n));if(o===-1)return;const i=this.polygonTotalPaths.length,a=o-1<=-1?i-1:o-1,l=o+1>=i?0:o+1,f=this.polygonTotalPaths.at(a),g=this.polygonTotalPaths.at(l);this.setPosition(f,g),this.onMouseMoveInDrawPolygon(e)});s(this,"onMouseUp",()=>{this.circleMarker=null,this.midCircleMarker=null,this.reset()});s(this,"onInPolygonEditorLine",e=>{if(this.circleMarker)return this.removeLineDistanceText();const n=e.lnglat,r=this.lines.getPointInPolyline(n);if(!r)return this.removeLineDistanceText();const[o,i]=r;this.lineLengthText||(this.lineLengthText=d(),this.lineLengthText.add(this.map)),this.updateDistanceText(this.lineLengthText,O(o,i))});s(this,"onMouseMoveInDrawPolygon",e=>{if(!this.startPosition||!this.lastPosition)return;const n=e.lnglat;this.updateDistanceText(this.startPointToCursorText,O(this.startPosition,n)),this.updateDistanceText(this.lastPointToCursorText,O(this.lastPosition,n))});if(!e)throw new Error("map not found!");this.map=e,n&&(this.polygonEditor=n),this.circleMarkers=new ue(this.map),this.midCircleMarkers=new ue(this.map),this.lines=new fe(this.map)}getPolygonEditorTargetPaths(){return this.polygonEditor?this.polygonEditor.getTarget().getPath()??[]:[]}setEditingMidTipMarkerListPath(e){return this.editingMidTipMarkerListPath=e,this}getEditingMidTipMarkerList(){var n,r;const{singleRingListHandle:e}=this.polygonEditor;if(this.editingMidTipMarkerListPath){if(typeof this.editingMidTipMarkerListPath=="function")return this.editingMidTipMarkerListPath(this.polygonEditor);if(typeof this.editingMidTipMarkerListPath=="string")return to(this.polygonEditor,this.editingMidTipMarkerListPath)}return(n=this.polygonEditor.editingMidTipMarkerList)!=null&&n.length?this.polygonEditor.editingMidTipMarkerList:e?(r=e==null?void 0:e.list)==null?void 0:r.editingMidTipMarkerList:[]}getPolygonEditorTargetTotalPaths(){const e=this.getPolygonEditorTargetPaths(),n=this.getEditingMidTipMarkerList();let r=0;const o=[],i=e.length;for(;r<i;){o.push(e[r]);const a=n[r];a&&o.push(a.getCenter()),r++}return o}start(e){var o,i,a;if(!e&&!this.polygonEditor)throw new Error("polygonEditor not found");this.polygonEditor=e;const{controlPoint:n,midControlPoint:r}=this.polygonEditor;return this.polygonPaths=this.getPolygonEditorTargetPaths(),this.circleMarkers.setOptions(n).createCircleMarkersByPaths(this.polygonPaths),this.polygonTotalPaths=this.getPolygonEditorTargetTotalPaths(),this.midCircleMarkers.setOptions(r).createCircleMarkersByPaths(this.polygonTotalPaths),this.lines.createLinesByPaths(this.polygonPaths),(o=this.polygonEditor)==null||o.on("adjust",this.onPolygonEditorAdjust),(i=this.polygonEditor)==null||i.on("removenode",this.onPolygonEditorAdjust),(a=this.polygonEditor)==null||a.on("addnode",this.onPolygonEditorAdjust),this.map.on("mousedown",this.onMouseDown),this.map.on("mousemove",this.onMovePolygonEditorPoint),this.map.on("mousemove",this.onMovePolygonEditorMidPoint),this.map.on("mousemove",this.onInPolygonEditorLine),this.map.on("mouseup",this.onMouseUp),this}stop(){var e,n,r;(e=this.polygonEditor)==null||e.off("adjust",this.onPolygonEditorAdjust),(n=this.polygonEditor)==null||n.off("removenode",this.onPolygonEditorAdjust),(r=this.polygonEditor)==null||r.off("addnode",this.onPolygonEditorAdjust),this.map.off("mousedown",this.onMouseDown),this.map.off("mousemove",this.onMovePolygonEditorPoint),this.map.off("mousemove",this.onMovePolygonEditorMidPoint),this.map.off("mousemove",this.onInPolygonEditorLine),this.map.off("mouseup",this.onMouseUp)}startLineRanging(e){if(!e)throw new Error("polygonEditor not found");this.polygon||(this.polygon=e,this.lines.createLinesByPaths(this.polygon.getPath()),this.map.on("mousemove",this.onInPolygonEditorLine))}stopLineRanging(){this.map.off("mousemove",this.onInPolygonEditorLine)}setPosition(e,n){this.startPosition=e,this.lastPosition=n,this.createDistanceText()}createDistanceText(){this.startPointToCursorText&&this.lastPointToCursorText||(this.startPointToCursorText=d(),this.lastPointToCursorText=d(),this.startPointToCursorText.setMap(this.map),this.lastPointToCursorText.setMap(this.map))}updateDistanceText(e,{text:n,textPos:r}){e.setText(n),e.setPosition(r)}removeLineDistanceText(){var e;(e=this.lineLengthText)==null||e.remove(),this.lineLengthText=null}removeDistanceText(){var e,n;(e=this.startPointToCursorText)==null||e.remove(),(n=this.lastPointToCursorText)==null||n.remove(),this.startPointToCursorText=null,this.lastPointToCursorText=null}reset(){return this.startPosition=null,this.lastPosition=null,this.removeDistanceText(),this.removeLineDistanceText(),this}destroy(){return console.log("=== 销毁 围栏编辑测距事件 =="),this.reset(),this.stop(),this.circleMarkers.destroy(),this}destroyLineRanging(){return console.log("=== 销毁 围栏查看测距事件 =="),this.polygon=null,this.startPosition=null,this.lastPosition=null,this.removeLineDistanceText(),this.stopLineRanging(),this}}class pe{constructor(e){s(this,"map");s(this,"lines",null);s(this,"polygon",null);s(this,"lineLengthText",null);s(this,"editingMidTipMarkerListPath",null);s(this,"onPolygonRanging",e=>{const n=e.lnglat,r=this.lines.getPointInPolyline(n);if(!r)return this.removeLineDistanceText();const[o,i]=r;this.lineLengthText||(this.lineLengthText=d(),this.lineLengthText.add(this.map)),this.updateDistanceText(this.lineLengthText,O(o,i))});if(!e)throw new Error("map not found!");this.map=e,this.lines=new fe(this.map)}start(e){if(!e)throw new Error("polygon not found");this.polygon||(this.polygon=e,this.lines.createLinesByPaths(this.polygon.getPath()),this.map.on("mousemove",this.onPolygonRanging))}stop(){this.map.off("mousemove",this.onPolygonRanging)}updateDistanceText(e,{text:n,textPos:r}){e.setText(n),e.setPosition(r)}removeLineDistanceText(){var e;(e=this.lineLengthText)==null||e.remove(),this.lineLengthText=null}destroy(){return this.polygon=null,this.stop(),this.removeLineDistanceText(),this}}const ss={PolygonRangingInDrawing:lt,PolygonEditorRanging:ge,PolygonRanging:pe};c.PolygonEditorRanging=ge,c.PolygonRanging=pe,c.PolygonRangingInDrawing=lt,c.default=ss,Object.defineProperties(c,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})});
