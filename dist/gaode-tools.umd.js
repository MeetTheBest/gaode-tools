(function(l,g){typeof exports=="object"&&typeof module!="undefined"?g(exports):typeof define=="function"&&define.amd?define(["exports"],g):(l=typeof globalThis!="undefined"?globalThis:l||self,g(l["gaode-tools"]={}))})(this,function(l){"use strict";var fs=Object.defineProperty;var be=Object.getOwnPropertySymbols;var ds=Object.prototype.hasOwnProperty,ps=Object.prototype.propertyIsEnumerable;var ht=(l,g,f)=>g in l?fs(l,g,{enumerable:!0,configurable:!0,writable:!0,value:f}):l[g]=f,b=(l,g)=>{for(var f in g||(g={}))ds.call(g,f)&&ht(l,f,g[f]);if(be)for(var f of be(g))ps.call(g,f)&&ht(l,f,g[f]);return l};var s=(l,g,f)=>(ht(l,typeof g!="symbol"?g+"":g,f),f);const g={"border-color":"#e1f5fe","font-size":"12px","border-radius":".25rem","background-color":"rgba(0,0,0,.4)","border-width":0,"text-align":"center",color:"#fff"},f=(t="",e={})=>new AMap.Text({text:t,style:b(b({},g),e),offset:[0,-10]}),O=(t,e)=>{const n=t.divideBy(2).add(e.divideBy(2));return{text:`${Math.round(t.distance(e))}米`,textPos:n}};let ut=class{constructor(e){s(this,"map");s(this,"startPointToCursorText",null);s(this,"lastPointToCursorText",null);s(this,"startPosition",null);s(this,"lastPosition",null);s(this,"getClickPosition",e=>{const n=e.lnglat;this.startPosition?this.startPosition&&(this.lastPosition=n,this.createDistanceText()):this.startPosition=n});s(this,"onMouseMoveInDrawPolygon",e=>{if(!this.startPosition||!this.lastPosition)return;const n=e.lnglat;this.updateDistanceText(this.startPointToCursorText,O(this.startPosition,n)),this.updateDistanceText(this.lastPointToCursorText,O(this.lastPosition,n))});if(!e)throw new Error("map not found!");this.map=e}start(){this.map.on("click",this.getClickPosition),this.map.on("mousemove",this.onMouseMoveInDrawPolygon)}stop(){this.map.off("click",this.getClickPosition),this.map.off("mousemove",this.onMouseMoveInDrawPolygon)}createDistanceText(){this.startPointToCursorText&&this.lastPointToCursorText||(this.startPointToCursorText=f(),this.startPointToCursorText.setMap(this.map),this.lastPointToCursorText=f(),this.lastPointToCursorText.setMap(this.map))}updateDistanceText(e,{text:n,textPos:r}){e.setText(n),e.setPosition(r)}removeDistanceText(){var e,n;(e=this.startPointToCursorText)==null||e.remove(),this.startPointToCursorText=null,(n=this.lastPointToCursorText)==null||n.remove(),this.lastPointToCursorText=null}reset(){return this.startPosition=null,this.lastPosition=null,this.removeDistanceText(),this}destroy(){return this.reset(),this.stop(),this}};var Ee=typeof global=="object"&&global&&global.Object===Object&&global;const gt=Ee;var $e=typeof self=="object"&&self&&self.Object===Object&&self,we=gt||$e||Function("return this")();const T=we;var _e=T.Symbol;const P=_e;var ft=Object.prototype,Ce=ft.hasOwnProperty,xe=ft.toString,k=P?P.toStringTag:void 0;function je(t){var e=Ce.call(t,k),n=t[k];try{t[k]=void 0;var r=!0}catch(i){}var o=xe.call(t);return r&&(e?t[k]=n:delete t[k]),o}var Ae=Object.prototype,Oe=Ae.toString;function Se(t){return Oe.call(t)}var Le="[object Null]",Ie="[object Undefined]",dt=P?P.toStringTag:void 0;function E(t){return t==null?t===void 0?Ie:Le:dt&&dt in Object(t)?je(t):Se(t)}function $(t){return t!=null&&typeof t=="object"}var ke="[object Symbol]";function H(t){return typeof t=="symbol"||$(t)&&E(t)==ke}function pt(t,e){for(var n=-1,r=t==null?0:t.length,o=Array(r);++n<r;)o[n]=e(t[n],n,t);return o}var De=Array.isArray;const w=De;var Fe=1/0,yt=P?P.prototype:void 0,Tt=yt?yt.toString:void 0;function Pt(t){if(typeof t=="string")return t;if(w(t))return pt(t,Pt)+"";if(H(t))return Tt?Tt.call(t):"";var e=t+"";return e=="0"&&1/t==-Fe?"-0":e}function D(t){var e=typeof t;return t!=null&&(e=="object"||e=="function")}function Be(t){return t}var Ue="[object AsyncFunction]",Re="[object Function]",Ge="[object GeneratorFunction]",ze="[object Proxy]";function mt(t){if(!D(t))return!1;var e=E(t);return e==Re||e==Ge||e==Ue||e==ze}var Ne=T["__core-js_shared__"];const V=Ne;var Mt=function(){var t=/[^.]+$/.exec(V&&V.keys&&V.keys.IE_PROTO||"");return t?"Symbol(src)_1."+t:""}();function Ke(t){return!!Mt&&Mt in t}var He=Function.prototype,Ve=He.toString;function _(t){if(t!=null){try{return Ve.call(t)}catch(e){}try{return t+""}catch(e){}}return""}var We=/[\\^$.*+?()[\]{}|]/g,Ye=/^\[object .+?Constructor\]$/,Xe=Function.prototype,qe=Object.prototype,Ze=Xe.toString,Je=qe.hasOwnProperty,Qe=RegExp("^"+Ze.call(Je).replace(We,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");function tn(t){if(!D(t)||Ke(t))return!1;var e=mt(t)?Qe:Ye;return e.test(_(t))}function en(t,e){return t==null?void 0:t[e]}function C(t,e){var n=en(t,e);return tn(n)?n:void 0}var nn=C(T,"WeakMap");const W=nn;var vt=Object.create,rn=function(){function t(){}return function(e){if(!D(e))return{};if(vt)return vt(e);t.prototype=e;var n=new t;return t.prototype=void 0,n}}();const on=rn;function sn(t,e,n){switch(n.length){case 0:return t.call(e);case 1:return t.call(e,n[0]);case 2:return t.call(e,n[0],n[1]);case 3:return t.call(e,n[0],n[1],n[2])}return t.apply(e,n)}function an(t,e){var n=-1,r=t.length;for(e||(e=Array(r));++n<r;)e[n]=t[n];return e}var ln=800,cn=16,hn=Date.now;function un(t){var e=0,n=0;return function(){var r=hn(),o=cn-(r-n);if(n=r,o>0){if(++e>=ln)return arguments[0]}else e=0;return t.apply(void 0,arguments)}}function gn(t){return function(){return t}}var fn=function(){try{var t=C(Object,"defineProperty");return t({},"",{}),t}catch(e){}}();const G=fn;var dn=G?function(t,e){return G(t,"toString",{configurable:!0,enumerable:!1,value:gn(e),writable:!0})}:Be,pn=un(dn);const yn=pn;function Tn(t,e){for(var n=-1,r=t==null?0:t.length;++n<r&&e(t[n],n,t)!==!1;);return t}var Pn=9007199254740991,mn=/^(?:0|[1-9]\d*)$/;function Mn(t,e){var n=typeof t;return e=e==null?Pn:e,!!e&&(n=="number"||n!="symbol"&&mn.test(t))&&t>-1&&t%1==0&&t<e}function bt(t,e,n){e=="__proto__"&&G?G(t,e,{configurable:!0,enumerable:!0,value:n,writable:!0}):t[e]=n}function Et(t,e){return t===e||t!==t&&e!==e}var vn=Object.prototype,bn=vn.hasOwnProperty;function $t(t,e,n){var r=t[e];(!(bn.call(t,e)&&Et(r,n))||n===void 0&&!(e in t))&&bt(t,e,n)}function F(t,e,n,r){var o=!n;n||(n={});for(var i=-1,a=e.length;++i<a;){var c=e[i],d=r?r(n[c],t[c],c,n,t):void 0;d===void 0&&(d=t[c]),o?bt(n,c,d):$t(n,c,d)}return n}var wt=Math.max;function En(t,e,n){return e=wt(e===void 0?t.length-1:e,0),function(){for(var r=arguments,o=-1,i=wt(r.length-e,0),a=Array(i);++o<i;)a[o]=r[e+o];o=-1;for(var c=Array(e+1);++o<e;)c[o]=r[o];return c[e]=n(a),sn(t,this,c)}}var $n=9007199254740991;function _t(t){return typeof t=="number"&&t>-1&&t%1==0&&t<=$n}function Ct(t){return t!=null&&_t(t.length)&&!mt(t)}var wn=Object.prototype;function Y(t){var e=t&&t.constructor,n=typeof e=="function"&&e.prototype||wn;return t===n}function _n(t,e){for(var n=-1,r=Array(t);++n<t;)r[n]=e(n);return r}var Cn="[object Arguments]";function xt(t){return $(t)&&E(t)==Cn}var jt=Object.prototype,xn=jt.hasOwnProperty,jn=jt.propertyIsEnumerable,An=xt(function(){return arguments}())?xt:function(t){return $(t)&&xn.call(t,"callee")&&!jn.call(t,"callee")};const At=An;function On(){return!1}var Ot=typeof l=="object"&&l&&!l.nodeType&&l,St=Ot&&typeof module=="object"&&module&&!module.nodeType&&module,Sn=St&&St.exports===Ot,Lt=Sn?T.Buffer:void 0,Ln=Lt?Lt.isBuffer:void 0,In=Ln||On;const It=In;var kn="[object Arguments]",Dn="[object Array]",Fn="[object Boolean]",Bn="[object Date]",Un="[object Error]",Rn="[object Function]",Gn="[object Map]",zn="[object Number]",Nn="[object Object]",Kn="[object RegExp]",Hn="[object Set]",Vn="[object String]",Wn="[object WeakMap]",Yn="[object ArrayBuffer]",Xn="[object DataView]",qn="[object Float32Array]",Zn="[object Float64Array]",Jn="[object Int8Array]",Qn="[object Int16Array]",tr="[object Int32Array]",er="[object Uint8Array]",nr="[object Uint8ClampedArray]",rr="[object Uint16Array]",or="[object Uint32Array]",u={};u[qn]=u[Zn]=u[Jn]=u[Qn]=u[tr]=u[er]=u[nr]=u[rr]=u[or]=!0,u[kn]=u[Dn]=u[Yn]=u[Fn]=u[Xn]=u[Bn]=u[Un]=u[Rn]=u[Gn]=u[zn]=u[Nn]=u[Kn]=u[Hn]=u[Vn]=u[Wn]=!1;function ir(t){return $(t)&&_t(t.length)&&!!u[E(t)]}function X(t){return function(e){return t(e)}}var kt=typeof l=="object"&&l&&!l.nodeType&&l,B=kt&&typeof module=="object"&&module&&!module.nodeType&&module,sr=B&&B.exports===kt,q=sr&&gt.process,ar=function(){try{var t=B&&B.require&&B.require("util").types;return t||q&&q.binding&&q.binding("util")}catch(e){}}();const S=ar;var Dt=S&&S.isTypedArray,lr=Dt?X(Dt):ir;const cr=lr;var hr=Object.prototype,ur=hr.hasOwnProperty;function Ft(t,e){var n=w(t),r=!n&&At(t),o=!n&&!r&&It(t),i=!n&&!r&&!o&&cr(t),a=n||r||o||i,c=a?_n(t.length,String):[],d=c.length;for(var p in t)(e||ur.call(t,p))&&!(a&&(p=="length"||o&&(p=="offset"||p=="parent")||i&&(p=="buffer"||p=="byteLength"||p=="byteOffset")||Mn(p,d)))&&c.push(p);return c}function Bt(t,e){return function(n){return t(e(n))}}var gr=Bt(Object.keys,Object);const fr=gr;var dr=Object.prototype,pr=dr.hasOwnProperty;function yr(t){if(!Y(t))return fr(t);var e=[];for(var n in Object(t))pr.call(t,n)&&n!="constructor"&&e.push(n);return e}function Z(t){return Ct(t)?Ft(t):yr(t)}function Tr(t){var e=[];if(t!=null)for(var n in Object(t))e.push(n);return e}var Pr=Object.prototype,mr=Pr.hasOwnProperty;function Mr(t){if(!D(t))return Tr(t);var e=Y(t),n=[];for(var r in t)r=="constructor"&&(e||!mr.call(t,r))||n.push(r);return n}function J(t){return Ct(t)?Ft(t,!0):Mr(t)}var vr=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,br=/^\w*$/;function Er(t,e){if(w(t))return!1;var n=typeof t;return n=="number"||n=="symbol"||n=="boolean"||t==null||H(t)?!0:br.test(t)||!vr.test(t)||e!=null&&t in Object(e)}var $r=C(Object,"create");const U=$r;function wr(){this.__data__=U?U(null):{},this.size=0}function _r(t){var e=this.has(t)&&delete this.__data__[t];return this.size-=e?1:0,e}var Cr="__lodash_hash_undefined__",xr=Object.prototype,jr=xr.hasOwnProperty;function Ar(t){var e=this.__data__;if(U){var n=e[t];return n===Cr?void 0:n}return jr.call(e,t)?e[t]:void 0}var Or=Object.prototype,Sr=Or.hasOwnProperty;function Lr(t){var e=this.__data__;return U?e[t]!==void 0:Sr.call(e,t)}var Ir="__lodash_hash_undefined__";function kr(t,e){var n=this.__data__;return this.size+=this.has(t)?0:1,n[t]=U&&e===void 0?Ir:e,this}function x(t){var e=-1,n=t==null?0:t.length;for(this.clear();++e<n;){var r=t[e];this.set(r[0],r[1])}}x.prototype.clear=wr,x.prototype.delete=_r,x.prototype.get=Ar,x.prototype.has=Lr,x.prototype.set=kr;function Dr(){this.__data__=[],this.size=0}function z(t,e){for(var n=t.length;n--;)if(Et(t[n][0],e))return n;return-1}var Fr=Array.prototype,Br=Fr.splice;function Ur(t){var e=this.__data__,n=z(e,t);if(n<0)return!1;var r=e.length-1;return n==r?e.pop():Br.call(e,n,1),--this.size,!0}function Rr(t){var e=this.__data__,n=z(e,t);return n<0?void 0:e[n][1]}function Gr(t){return z(this.__data__,t)>-1}function zr(t,e){var n=this.__data__,r=z(n,t);return r<0?(++this.size,n.push([t,e])):n[r][1]=e,this}function m(t){var e=-1,n=t==null?0:t.length;for(this.clear();++e<n;){var r=t[e];this.set(r[0],r[1])}}m.prototype.clear=Dr,m.prototype.delete=Ur,m.prototype.get=Rr,m.prototype.has=Gr,m.prototype.set=zr;var Nr=C(T,"Map");const R=Nr;function Kr(){this.size=0,this.__data__={hash:new x,map:new(R||m),string:new x}}function Hr(t){var e=typeof t;return e=="string"||e=="number"||e=="symbol"||e=="boolean"?t!=="__proto__":t===null}function N(t,e){var n=t.__data__;return Hr(e)?n[typeof e=="string"?"string":"hash"]:n.map}function Vr(t){var e=N(this,t).delete(t);return this.size-=e?1:0,e}function Wr(t){return N(this,t).get(t)}function Yr(t){return N(this,t).has(t)}function Xr(t,e){var n=N(this,t),r=n.size;return n.set(t,e),this.size+=n.size==r?0:1,this}function M(t){var e=-1,n=t==null?0:t.length;for(this.clear();++e<n;){var r=t[e];this.set(r[0],r[1])}}M.prototype.clear=Kr,M.prototype.delete=Vr,M.prototype.get=Wr,M.prototype.has=Yr,M.prototype.set=Xr;var qr="Expected a function";function Q(t,e){if(typeof t!="function"||e!=null&&typeof e!="function")throw new TypeError(qr);var n=function(){var r=arguments,o=e?e.apply(this,r):r[0],i=n.cache;if(i.has(o))return i.get(o);var a=t.apply(this,r);return n.cache=i.set(o,a)||i,a};return n.cache=new(Q.Cache||M),n}Q.Cache=M;var Zr=500;function Jr(t){var e=Q(t,function(r){return n.size===Zr&&n.clear(),r}),n=e.cache;return e}var Qr=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,to=/\\(\\)?/g,eo=Jr(function(t){var e=[];return t.charCodeAt(0)===46&&e.push(""),t.replace(Qr,function(n,r,o,i){e.push(o?i.replace(to,"$1"):r||n)}),e});const no=eo;function ro(t){return t==null?"":Pt(t)}function tt(t,e){return w(t)?t:Er(t,e)?[t]:no(ro(t))}var oo=1/0;function Ut(t){if(typeof t=="string"||H(t))return t;var e=t+"";return e=="0"&&1/t==-oo?"-0":e}function Rt(t,e){e=tt(e,t);for(var n=0,r=e.length;t!=null&&n<r;)t=t[Ut(e[n++])];return n&&n==r?t:void 0}function Gt(t,e,n){var r=t==null?void 0:Rt(t,e);return r===void 0?n:r}function et(t,e){for(var n=-1,r=e.length,o=t.length;++n<r;)t[o+n]=e[n];return t}var zt=P?P.isConcatSpreadable:void 0;function io(t){return w(t)||At(t)||!!(zt&&t&&t[zt])}function Nt(t,e,n,r,o){var i=-1,a=t.length;for(n||(n=io),o||(o=[]);++i<a;){var c=t[i];e>0&&n(c)?e>1?Nt(c,e-1,n,r,o):et(o,c):r||(o[o.length]=c)}return o}function so(t){var e=t==null?0:t.length;return e?Nt(t,1):[]}function ao(t){return yn(En(t,void 0,so),t+"")}var lo=Bt(Object.getPrototypeOf,Object);const nt=lo;var co="[object Object]",ho=Function.prototype,uo=Object.prototype,Kt=ho.toString,go=uo.hasOwnProperty,fo=Kt.call(Object);function po(t){if(!$(t)||E(t)!=co)return!1;var e=nt(t);if(e===null)return!0;var n=go.call(e,"constructor")&&e.constructor;return typeof n=="function"&&n instanceof n&&Kt.call(n)==fo}function yo(t,e,n){var r=-1,o=t.length;e<0&&(e=-e>o?0:o+e),n=n>o?o:n,n<0&&(n+=o),o=e>n?0:n-e>>>0,e>>>=0;for(var i=Array(o);++r<o;)i[r]=t[r+e];return i}function To(){this.__data__=new m,this.size=0}function Po(t){var e=this.__data__,n=e.delete(t);return this.size=e.size,n}function mo(t){return this.__data__.get(t)}function Mo(t){return this.__data__.has(t)}var vo=200;function bo(t,e){var n=this.__data__;if(n instanceof m){var r=n.__data__;if(!R||r.length<vo-1)return r.push([t,e]),this.size=++n.size,this;n=this.__data__=new M(r)}return n.set(t,e),this.size=n.size,this}function L(t){var e=this.__data__=new m(t);this.size=e.size}L.prototype.clear=To,L.prototype.delete=Po,L.prototype.get=mo,L.prototype.has=Mo,L.prototype.set=bo;function Eo(t,e){return t&&F(e,Z(e),t)}function $o(t,e){return t&&F(e,J(e),t)}var Ht=typeof l=="object"&&l&&!l.nodeType&&l,Vt=Ht&&typeof module=="object"&&module&&!module.nodeType&&module,wo=Vt&&Vt.exports===Ht,Wt=wo?T.Buffer:void 0,Yt=Wt?Wt.allocUnsafe:void 0;function _o(t,e){if(e)return t.slice();var n=t.length,r=Yt?Yt(n):new t.constructor(n);return t.copy(r),r}function Co(t,e){for(var n=-1,r=t==null?0:t.length,o=0,i=[];++n<r;){var a=t[n];e(a,n,t)&&(i[o++]=a)}return i}function Xt(){return[]}var xo=Object.prototype,jo=xo.propertyIsEnumerable,qt=Object.getOwnPropertySymbols,Ao=qt?function(t){return t==null?[]:(t=Object(t),Co(qt(t),function(e){return jo.call(t,e)}))}:Xt;const rt=Ao;function Oo(t,e){return F(t,rt(t),e)}var So=Object.getOwnPropertySymbols,Lo=So?function(t){for(var e=[];t;)et(e,rt(t)),t=nt(t);return e}:Xt;const Zt=Lo;function Io(t,e){return F(t,Zt(t),e)}function Jt(t,e,n){var r=e(t);return w(t)?r:et(r,n(t))}function ko(t){return Jt(t,Z,rt)}function Qt(t){return Jt(t,J,Zt)}var Do=C(T,"DataView");const ot=Do;var Fo=C(T,"Promise");const it=Fo;var Bo=C(T,"Set");const st=Bo;var te="[object Map]",Uo="[object Object]",ee="[object Promise]",ne="[object Set]",re="[object WeakMap]",oe="[object DataView]",Ro=_(ot),Go=_(R),zo=_(it),No=_(st),Ko=_(W),j=E;(ot&&j(new ot(new ArrayBuffer(1)))!=oe||R&&j(new R)!=te||it&&j(it.resolve())!=ee||st&&j(new st)!=ne||W&&j(new W)!=re)&&(j=function(t){var e=E(t),n=e==Uo?t.constructor:void 0,r=n?_(n):"";if(r)switch(r){case Ro:return oe;case Go:return te;case zo:return ee;case No:return ne;case Ko:return re}return e});const at=j;var Ho=Object.prototype,Vo=Ho.hasOwnProperty;function Wo(t){var e=t.length,n=new t.constructor(e);return e&&typeof t[0]=="string"&&Vo.call(t,"index")&&(n.index=t.index,n.input=t.input),n}var Yo=T.Uint8Array;const ie=Yo;function lt(t){var e=new t.constructor(t.byteLength);return new ie(e).set(new ie(t)),e}function Xo(t,e){var n=e?lt(t.buffer):t.buffer;return new t.constructor(n,t.byteOffset,t.byteLength)}var qo=/\w*$/;function Zo(t){var e=new t.constructor(t.source,qo.exec(t));return e.lastIndex=t.lastIndex,e}var se=P?P.prototype:void 0,ae=se?se.valueOf:void 0;function Jo(t){return ae?Object(ae.call(t)):{}}function Qo(t,e){var n=e?lt(t.buffer):t.buffer;return new t.constructor(n,t.byteOffset,t.length)}var ti="[object Boolean]",ei="[object Date]",ni="[object Map]",ri="[object Number]",oi="[object RegExp]",ii="[object Set]",si="[object String]",ai="[object Symbol]",li="[object ArrayBuffer]",ci="[object DataView]",hi="[object Float32Array]",ui="[object Float64Array]",gi="[object Int8Array]",fi="[object Int16Array]",di="[object Int32Array]",pi="[object Uint8Array]",yi="[object Uint8ClampedArray]",Ti="[object Uint16Array]",Pi="[object Uint32Array]";function mi(t,e,n){var r=t.constructor;switch(e){case li:return lt(t);case ti:case ei:return new r(+t);case ci:return Xo(t,n);case hi:case ui:case gi:case fi:case di:case pi:case yi:case Ti:case Pi:return Qo(t,n);case ni:return new r;case ri:case si:return new r(t);case oi:return Zo(t);case ii:return new r;case ai:return Jo(t)}}function Mi(t){return typeof t.constructor=="function"&&!Y(t)?on(nt(t)):{}}var vi="[object Map]";function bi(t){return $(t)&&at(t)==vi}var le=S&&S.isMap,Ei=le?X(le):bi;const $i=Ei;var wi="[object Set]";function _i(t){return $(t)&&at(t)==wi}var ce=S&&S.isSet,Ci=ce?X(ce):_i;const xi=Ci;var ji=1,Ai=2,Oi=4,he="[object Arguments]",Si="[object Array]",Li="[object Boolean]",Ii="[object Date]",ki="[object Error]",ue="[object Function]",Di="[object GeneratorFunction]",Fi="[object Map]",Bi="[object Number]",ge="[object Object]",Ui="[object RegExp]",Ri="[object Set]",Gi="[object String]",zi="[object Symbol]",Ni="[object WeakMap]",Ki="[object ArrayBuffer]",Hi="[object DataView]",Vi="[object Float32Array]",Wi="[object Float64Array]",Yi="[object Int8Array]",Xi="[object Int16Array]",qi="[object Int32Array]",Zi="[object Uint8Array]",Ji="[object Uint8ClampedArray]",Qi="[object Uint16Array]",ts="[object Uint32Array]",h={};h[he]=h[Si]=h[Ki]=h[Hi]=h[Li]=h[Ii]=h[Vi]=h[Wi]=h[Yi]=h[Xi]=h[qi]=h[Fi]=h[Bi]=h[ge]=h[Ui]=h[Ri]=h[Gi]=h[zi]=h[Zi]=h[Ji]=h[Qi]=h[ts]=!0,h[ki]=h[ue]=h[Ni]=!1;function K(t,e,n,r,o,i){var a,c=e&ji,d=e&Ai,p=e&Oi;if(n&&(a=o?n(t,r,o,i):n(t)),a!==void 0)return a;if(!D(t))return t;var y=w(t);if(y){if(a=Wo(t),!c)return an(t,a)}else{var I=at(t),me=I==ue||I==Di;if(It(t))return _o(t,c);if(I==ge||I==he||me&&!o){if(a=d||me?{}:Mi(t),!c)return d?Io(t,$o(a,t)):Oo(t,Eo(a,t))}else{if(!h[I])return o?t:{};a=mi(t,I,c)}}i||(i=new L);var Me=i.get(t);if(Me)return Me;i.set(t,a),xi(t)?t.forEach(function(v){a.add(K(v,e,n,v,t,i))}):$i(t)&&t.forEach(function(v,A){a.set(A,K(v,e,n,A,t,i))});var gs=p?d?Qt:ko:d?J:Z,ve=y?void 0:gs(t);return Tn(ve||t,function(v,A){ve&&(A=v,v=t[A]),$t(a,A,K(v,e,n,A,t,i))}),a}function es(t){var e=t==null?0:t.length;return e?t[e-1]:void 0}function ns(t,e){return e.length<2?t:Rt(t,yo(e,0,-1))}function rs(t,e){return e=tt(e,t),t=ns(t,e),t==null||delete t[Ut(es(e))]}function os(t){return po(t)?void 0:t}var is=1,ss=2,as=4,ls=ao(function(t,e){var n={};if(t==null)return n;var r=!1;e=pt(e,function(i){return i=tt(i,t),r||(r=i.length>1),i}),F(t,Qt(t),n),r&&(n=K(n,is|ss|as,os));for(var o=e.length;o--;)rs(n,e[o]);return n});const cs=ls,fe={radius:6,zIndex:0,strokeOpacity:0,fillOpacity:0};class ct{constructor(e){s(this,"map");s(this,"options",b({},fe));s(this,"circleMarkers",[]);this.map=e}setOptions(e){return this.options=b(b({},e),cs(fe,"radius")),this}createCircleMarkersByPaths(e){this.removeFromTheMap(),this.reset(),e.forEach(n=>{this.circleMarkers.push(this.createCircleMarker(n))}),this.addToMap()}createCircleMarker(e){return new AMap.CircleMarker(b({center:e},this.options))}addToMap(){this.map.add(this.circleMarkers)}removeFromTheMap(){this.map.remove(this.circleMarkers)}getPointInCircleMarkers(e){var n;return(n=this.circleMarkers.find(r=>this.isPointInCircle(e,r)))!=null?n:null}getInCircleMarkersPoint(e){const n=this.circleMarkers.find(o=>this.isPointInCircle(e,o));return this.circleMarkers.findIndex(o=>o===n)%2===0?null:n!=null?n:null}isPointInCircle(e,n){return n.contains(e)}reset(){this.circleMarkers=[]}destroy(){this.removeFromTheMap(),this.reset()}}const de={zIndex:1,strokeColor:"#00D3FC",strokeWeight:8,strokeOpacity:0};class pe{constructor(e){s(this,"map");s(this,"linesPath",[]);s(this,"lines",[]);if(!e)throw new Error("map not found");this.map=e}getLinesByPaths(e){let n=0;const r=e.length;for(;n<r;){const o=n+1>=r?0:n+1;this.linesPath.push([e[n],e[o]]),n++}return this.linesPath}createLinesByPaths(e){this.reset(),this.getLinesByPaths(e)}createPolyLine(e){return new AMap.Polyline(b({path:e},de))}addToMap(){this.map.add(this.lines)}removeFromTheMap(){this.map.remove(this.lines)}getPointInPolyline(e){const n=this.map.getResolution(),r=de.strokeWeight*n;return this.linesPath.find(i=>AMap.GeometryUtil.isPointOnSegment(e,i[0],i[1],r))}reset(){this.linesPath=[],this.lines=[]}}class ye{constructor(e,n){s(this,"map");s(this,"circleMarkers",null);s(this,"midCircleMarkers",null);s(this,"lines",null);s(this,"polygonEditor",null);s(this,"polygonPaths",[]);s(this,"polygonTotalPaths",[]);s(this,"polygon",null);s(this,"startPointToCursorText",null);s(this,"lastPointToCursorText",null);s(this,"lineLengthText",null);s(this,"circleMarker",null);s(this,"midCircleMarker",null);s(this,"startPosition",null);s(this,"lastPosition",null);s(this,"editingMidTipMarkerListPath",null);s(this,"onPolygonEditorAdjust",({target:e})=>{this.polygonPaths=e.getPath(),this.circleMarkers.createCircleMarkersByPaths(this.polygonPaths),this.lines.createLinesByPaths(this.polygonPaths),Promise.resolve().then(()=>{this.polygonTotalPaths=this.getPolygonEditorTargetTotalPaths(),this.midCircleMarkers.createCircleMarkersByPaths(this.polygonTotalPaths)}),this.reset()});s(this,"onMouseDown",e=>{const n=e.lnglat;this.circleMarker=this.circleMarkers.getPointInCircleMarkers(n),this.midCircleMarker=this.midCircleMarkers.getInCircleMarkersPoint(n)});s(this,"onMovePolygonEditorPoint",e=>{if(this.midCircleMarker)return;if(!this.circleMarker){this.reset();return}const n=this.circleMarker.getCenter(),r=y=>`${y.lng}-${y.lat}`;let o=this.polygonPaths.findIndex(y=>r(y)===r(n));if(o===-1)return;const i=this.polygonPaths.length,a=o-1<=-1?i-1:o-1,c=o+1>=i?0:o+1,d=this.polygonPaths.at(a),p=this.polygonPaths.at(c);this.setPosition(d,p),this.onMouseMoveInDrawPolygon(e)});s(this,"onMovePolygonEditorMidPoint",e=>{if(this.circleMarker)return;if(!this.midCircleMarker){this.reset();return}const n=this.midCircleMarker.getCenter(),r=y=>`${y.lng}-${y.lat}`;let o=this.polygonTotalPaths.findIndex(y=>r(y)===r(n));if(o===-1)return;const i=this.polygonTotalPaths.length,a=o-1<=-1?i-1:o-1,c=o+1>=i?0:o+1,d=this.polygonTotalPaths.at(a),p=this.polygonTotalPaths.at(c);this.setPosition(d,p),this.onMouseMoveInDrawPolygon(e)});s(this,"onMouseUp",()=>{this.circleMarker=null,this.midCircleMarker=null,this.reset()});s(this,"onInPolygonEditorLine",e=>{if(this.circleMarker)return this.removeLineDistanceText();const n=e.lnglat,r=this.lines.getPointInPolyline(n);if(!r)return this.removeLineDistanceText();const[o,i]=r;this.lineLengthText||(this.lineLengthText=f(),this.lineLengthText.add(this.map)),this.updateDistanceText(this.lineLengthText,O(o,i))});s(this,"onMouseMoveInDrawPolygon",e=>{if(!this.startPosition||!this.lastPosition)return;const n=e.lnglat;this.updateDistanceText(this.startPointToCursorText,O(this.startPosition,n)),this.updateDistanceText(this.lastPointToCursorText,O(this.lastPosition,n))});if(!e)throw new Error("map not found!");this.map=e,n&&(this.polygonEditor=n),this.circleMarkers=new ct(this.map),this.midCircleMarkers=new ct(this.map),this.lines=new pe(this.map)}getPolygonEditorTargetPaths(){var e;return this.polygonEditor?(e=this.polygonEditor.getTarget().getPath())!=null?e:[]:[]}setEditingMidTipMarkerListPath(e){return this.editingMidTipMarkerListPath=e,this}getEditingMidTipMarkerList(){var n,r;const{singleRingListHandle:e}=this.polygonEditor;if(this.editingMidTipMarkerListPath){if(typeof this.editingMidTipMarkerListPath=="function")return this.editingMidTipMarkerListPath(this.polygonEditor);if(typeof this.editingMidTipMarkerListPath=="string")return Gt(this.polygonEditor,this.editingMidTipMarkerListPath)}return(n=this.polygonEditor.editingMidTipMarkerList)!=null&&n.length?this.polygonEditor.editingMidTipMarkerList:e?(r=e==null?void 0:e.list)==null?void 0:r.editingMidTipMarkerList:[]}getPolygonEditorTargetTotalPaths(){const e=this.getPolygonEditorTargetPaths(),n=this.getEditingMidTipMarkerList();let r=0;const o=[],i=e.length;for(;r<i;){o.push(e[r]);const a=n[r];a&&o.push(a.getCenter()),r++}return o}start(e){var o,i,a;if(!e&&!this.polygonEditor)throw new Error("polygonEditor not found");this.polygonEditor=e;const{controlPoint:n,midControlPoint:r}=this.polygonEditor;return this.polygonPaths=this.getPolygonEditorTargetPaths(),this.circleMarkers.setOptions(n).createCircleMarkersByPaths(this.polygonPaths),this.polygonTotalPaths=this.getPolygonEditorTargetTotalPaths(),this.midCircleMarkers.setOptions(r).createCircleMarkersByPaths(this.polygonTotalPaths),this.lines.createLinesByPaths(this.polygonPaths),(o=this.polygonEditor)==null||o.on("adjust",this.onPolygonEditorAdjust),(i=this.polygonEditor)==null||i.on("removenode",this.onPolygonEditorAdjust),(a=this.polygonEditor)==null||a.on("addnode",this.onPolygonEditorAdjust),this.map.on("mousedown",this.onMouseDown),this.map.on("mousemove",this.onMovePolygonEditorPoint),this.map.on("mousemove",this.onMovePolygonEditorMidPoint),this.map.on("mousemove",this.onInPolygonEditorLine),this.map.on("mouseup",this.onMouseUp),this}stop(){var e,n,r;(e=this.polygonEditor)==null||e.off("adjust",this.onPolygonEditorAdjust),(n=this.polygonEditor)==null||n.off("removenode",this.onPolygonEditorAdjust),(r=this.polygonEditor)==null||r.off("addnode",this.onPolygonEditorAdjust),this.map.off("mousedown",this.onMouseDown),this.map.off("mousemove",this.onMovePolygonEditorPoint),this.map.off("mousemove",this.onMovePolygonEditorMidPoint),this.map.off("mousemove",this.onInPolygonEditorLine),this.map.off("mouseup",this.onMouseUp)}startLineRanging(e){if(!e)throw new Error("polygonEditor not found");this.polygon||(this.polygon=e,this.lines.createLinesByPaths(this.polygon.getPath()),this.map.on("mousemove",this.onInPolygonEditorLine))}stopLineRanging(){this.map.off("mousemove",this.onInPolygonEditorLine)}setPosition(e,n){this.startPosition=e,this.lastPosition=n,this.createDistanceText()}createDistanceText(){this.startPointToCursorText&&this.lastPointToCursorText||(this.startPointToCursorText=f(),this.lastPointToCursorText=f(),this.startPointToCursorText.setMap(this.map),this.lastPointToCursorText.setMap(this.map))}updateDistanceText(e,{text:n,textPos:r}){e.setText(n),e.setPosition(r)}removeLineDistanceText(){var e;(e=this.lineLengthText)==null||e.remove(),this.lineLengthText=null}removeDistanceText(){var e,n;(e=this.startPointToCursorText)==null||e.remove(),(n=this.lastPointToCursorText)==null||n.remove(),this.startPointToCursorText=null,this.lastPointToCursorText=null}reset(){return this.startPosition=null,this.lastPosition=null,this.removeDistanceText(),this.removeLineDistanceText(),this}destroy(){return console.log("=== 销毁 围栏编辑测距事件 =="),this.reset(),this.stop(),this.circleMarkers.destroy(),this}destroyLineRanging(){return console.log("=== 销毁 围栏查看测距事件 =="),this.polygon=null,this.startPosition=null,this.lastPosition=null,this.removeLineDistanceText(),this.stopLineRanging(),this}}class Te{constructor(e){s(this,"map");s(this,"lines",null);s(this,"polygon",null);s(this,"lineLengthText",null);s(this,"editingMidTipMarkerListPath",null);s(this,"onPolygonRanging",e=>{const n=e.lnglat,r=this.lines.getPointInPolyline(n);if(!r)return this.removeLineDistanceText();const[o,i]=r;this.lineLengthText||(this.lineLengthText=f(),this.lineLengthText.add(this.map)),this.updateDistanceText(this.lineLengthText,O(o,i))});if(!e)throw new Error("map not found!");this.map=e,this.lines=new pe(this.map)}start(e){if(!e)throw new Error("polygon not found");this.polygon||(this.polygon=e,this.lines.createLinesByPaths(this.polygon.getPath()),this.map.on("mousemove",this.onPolygonRanging))}stop(){this.map.off("mousemove",this.onPolygonRanging)}updateDistanceText(e,{text:n,textPos:r}){e.setText(n),e.setPosition(r)}removeLineDistanceText(){var e;(e=this.lineLengthText)==null||e.remove(),this.lineLengthText=null}destroy(){return this.polygon=null,this.stop(),this.removeLineDistanceText(),this}}class hs{constructor(){s(this,"events",{})}getEvents(e){return this.events[e]||(this.events[e]=[]),this.events[e]}emit(e,...n){this.getEvents(e).forEach(o=>o(...n))}on(e,n){!e||typeof e!="string"||this.getEvents(e).push(n)}once(e,n){if(!e||typeof e!="string")return;const r=o=>{n(o),this.off(e,r)};this.on(e,r)}off(e,n){!e||typeof e!="string"||(this.events[e]=this.getEvents(e).filter(r=>r!==n))}hasEvents(e,n){return!!this.getEvents(e).find(r=>r===n)}clearEvents(e){e?this.events[e]=[]:this.events={}}}class Pe extends hs{constructor(n){super();s(this,"map");s(this,"circleMarkers",null);s(this,"polygonEditor",null);s(this,"polygonTotalPaths",[]);s(this,"circleMarker",null);s(this,"editingMidTipMarkerListPath",null);s(this,"onPolygonEditorAdjust",()=>{Promise.resolve().then(()=>{this.polygonTotalPaths=this.getPolygonEditorTargetTotalPaths(),this.circleMarkers.createCircleMarkersByPaths(this.polygonTotalPaths)})});s(this,"onMouseDown",n=>{const r=n.lnglat;this.circleMarker=this.circleMarkers.getPointInCircleMarkers(r),!(!this.circleMarker||!this.getEvents("mousedown").length)&&this.emit("mousedown",this.circleMarker)});s(this,"onMouseMove",n=>{!this.circleMarker||!this.getEvents("mousemove").length||this.emit("mousemove",this.circleMarker,n)});s(this,"onMouseUp",()=>{!this.getEvents("mouseup").length||!this.circleMarker||(this.emit("mouseup",this.circleMarker),this.circleMarker=null)});this.map=n.map,this.polygonEditor=n,this.circleMarkers=new ct(this.map),this.start(this.polygonEditor)}getPolygonEditorTargetPaths(){var n;return this.polygonEditor?(n=this.polygonEditor.getTarget().getPath())!=null?n:[]:[]}setEditingMidTipMarkerListPath(n){return this.editingMidTipMarkerListPath=n,this}getEditingMidTipMarkerList(){var r,o;const{singleRingListHandle:n}=this.polygonEditor;if(this.editingMidTipMarkerListPath){if(typeof this.editingMidTipMarkerListPath=="function")return this.editingMidTipMarkerListPath(this.polygonEditor);if(typeof this.editingMidTipMarkerListPath=="string")return Gt(this.polygonEditor,this.editingMidTipMarkerListPath)}return(r=this.polygonEditor.editingMidTipMarkerList)!=null&&r.length?this.polygonEditor.editingMidTipMarkerList:n?(o=n==null?void 0:n.list)==null?void 0:o.editingMidTipMarkerList:[]}getPolygonEditorTargetTotalPaths(){const n=this.getPolygonEditorTargetPaths(),r=this.getEditingMidTipMarkerList();let o=0;const i=[],a=n.length;for(;o<a;){i.push(n[o]);const c=r[o];c&&i.push(c.getCenter()),o++}return i}start(n){var o,i,a;if(!n&&!this.polygonEditor)throw new Error("polygonEditor not found");this.polygonEditor=n;const{midControlPoint:r}=this.polygonEditor;return this.polygonTotalPaths=this.getPolygonEditorTargetTotalPaths(),this.circleMarkers.setOptions(r).createCircleMarkersByPaths(this.polygonTotalPaths),(o=this.polygonEditor)==null||o.on("adjust",this.onPolygonEditorAdjust),(i=this.polygonEditor)==null||i.on("removenode",this.onPolygonEditorAdjust),(a=this.polygonEditor)==null||a.on("addnode",this.onPolygonEditorAdjust),this.map.on("mousedown",this.onMouseDown),this.map.on("mousemove",this.onMouseMove),this.map.on("mouseup",this.onMouseUp),this}stop(){this.map.off("mousedown",this.onMouseDown),this.map.off("mousemove",this.onMouseMove),this.map.off("mouseup",this.onMouseUp)}destroy(){return this.stop(),this.circleMarkers.destroy(),this}}const us={PolygonRangingInDrawing:ut,PolygonEditorRanging:ye,PolygonEditorEvent:Pe,PolygonRanging:Te};l.PolygonEditorEvent=Pe,l.PolygonEditorRanging=ye,l.PolygonRanging=Te,l.PolygonRangingInDrawing=ut,l.default=us,Object.defineProperties(l,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})});
